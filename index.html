<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Catalogo Studi Plimsoll - Sistema Avanzato di Business Intelligence Industriale</title>
    <meta name="description" content="Piattaforma avanzata per la ricerca e analisi di 7.895+ studi industriali Plimsoll con mappatura supply chain, classificazione ATECO automatica e suggerimenti AI.">
    
    <style>
        /* ===== PLIMSOLL BRAND DESIGN SYSTEM ===== */
        :root {
            --plimsoll-primary: #1a365d;
            --plimsoll-secondary: #2d3748;
            --plimsoll-accent: #00a0b0;
            --plimsoll-gold: #d69e2e;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
            --info: #17a2b8;
            --bg-primary: #ffffff;
            --bg-secondary: #f8f9fa;
            --bg-accent: #e2e8f0;
            --text-primary: #212529;
            --text-secondary: #6c757d;
            --text-muted: #868e96;
            --border-color: #dee2e6;
            --shadow-sm: 0 0.125rem 0.25rem rgba(26, 54, 93, 0.075);
            --shadow-md: 0 0.5rem 1rem rgba(26, 54, 93, 0.15);
            --shadow-lg: 0 1rem 3rem rgba(26, 54, 93, 0.175);
            --radius-sm: 0.25rem;
            --radius-md: 0.375rem;
            --radius-lg: 0.5rem;
            --radius-xl: 0.75rem;
            --spacing-xs: 0.25rem;
            --spacing-sm: 0.5rem;
            --spacing-md: 1rem;
            --spacing-lg: 1.5rem;
            --spacing-xl: 2rem;
            --spacing-2xl: 3rem;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: var(--bg-secondary);
            color: var(--text-primary);
            line-height: 1.6;
            font-size: 14px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 var(--spacing-lg);
        }

        /* ===== HEADER SYSTEM ===== */
        .header {
            background: linear-gradient(135deg, var(--plimsoll-primary) 0%, var(--plimsoll-accent) 100%);
            color: white;
            padding: var(--spacing-lg) 0;
            box-shadow: var(--shadow-md);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: var(--spacing-md);
        }

        .header-brand h1 {
            font-size: 1.75rem;
            font-weight: 700;
            margin-bottom: var(--spacing-xs);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .header-subtitle {
            font-size: 0.8rem;
            opacity: 0.9;
            font-weight: 300;
        }

        .header-actions {
            display: flex;
            gap: var(--spacing-sm);
            align-items: center;
        }

        .header-contact {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: var(--spacing-xs);
            font-size: 0.8rem;
        }

        .contact-item {
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
        }

        .contact-item a {
            color: white;
            text-decoration: none;
            opacity: 0.9;
            transition: opacity 0.2s;
        }

        .contact-item a:hover { opacity: 1; }

        /* ===== BUTTONS SYSTEM ===== */
        .btn {
            display: inline-flex;
            align-items: center;
            gap: var(--spacing-xs);
            padding: var(--spacing-sm) var(--spacing-md);
            border: none;
            border-radius: var(--radius-md);
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            text-decoration: none;
            transition: all 0.2s;
            white-space: nowrap;
        }

        .btn-sm {
            padding: var(--spacing-xs) var(--spacing-sm);
            font-size: 0.75rem;
        }

        .btn-lg {
            padding: var(--spacing-md) var(--spacing-xl);
            font-size: 1rem;
        }

        .btn-primary {
            background: var(--plimsoll-primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--plimsoll-secondary);
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: var(--plimsoll-secondary);
            color: white;
        }

        .btn-accent {
            background: var(--plimsoll-accent);
            color: white;
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-warning {
            background: var(--warning);
            color: white;
        }

        .btn-outline {
            background: transparent;
            color: var(--plimsoll-primary);
            border: 2px solid var(--plimsoll-primary);
        }

        .btn-outline:hover {
            background: var(--plimsoll-primary);
            color: white;
        }

        /* ===== HERO SECTION ===== */
        .hero {
            background: linear-gradient(135deg, var(--plimsoll-accent) 0%, var(--plimsoll-primary) 100%);
            color: white;
            padding: var(--spacing-2xl) 0;
            text-align: center;
        }

        .hero h2 {
            font-size: 2.5rem;
            font-weight: 300;
            margin-bottom: var(--spacing-md);
        }

        .hero p {
            font-size: 1.125rem;
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto var(--spacing-lg);
        }

        .hero-stats {
            display: flex;
            justify-content: center;
            gap: var(--spacing-2xl);
            flex-wrap: wrap;
            margin-top: var(--spacing-xl);
        }

        .hero-stat {
            text-align: center;
        }

        .hero-stat-number {
            display: block;
            font-size: 2rem;
            font-weight: 700;
        }

        .hero-stat-label {
            font-size: 0.875rem;
            opacity: 0.9;
            margin-top: var(--spacing-xs);
        }

        /* ===== DASHBOARD SYSTEM ===== */
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: var(--spacing-lg);
            margin: var(--spacing-xl) 0;
        }

        .stat-card {
            background: var(--bg-primary);
            border-radius: var(--radius-lg);
            padding: var(--spacing-xl);
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border-color);
            position: relative;
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--plimsoll-accent);
        }

        .stat-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .stat-info h3 {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-bottom: var(--spacing-sm);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
        }

        .stat-number {
            font-size: 2.25rem;
            font-weight: 800;
            color: var(--plimsoll-primary);
            line-height: 1;
            margin-bottom: var(--spacing-xs);
        }

        .stat-detail {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .stat-icon {
            font-size: 2rem;
            color: var(--plimsoll-accent);
            opacity: 0.7;
        }

        /* ===== SEARCH SYSTEM ===== */
        .search-section {
            background: var(--bg-primary);
            padding: var(--spacing-xl);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-sm);
            margin-bottom: var(--spacing-xl);
        }

        .search-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-lg);
            flex-wrap: wrap;
            gap: var(--spacing-md);
        }

        .search-title {
            color: var(--plimsoll-primary);
            font-size: 1.25rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .search-container {
            position: relative;
            margin-bottom: var(--spacing-lg);
        }

        .search-input {
            width: 100%;
            padding: var(--spacing-md) var(--spacing-md) var(--spacing-md) 2.5rem;
            border: 2px solid var(--border-color);
            border-radius: var(--radius-md);
            font-size: 1rem;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        .search-input:focus {
            border-color: var(--plimsoll-accent);
            box-shadow: 0 0 0 3px rgba(0, 160, 176, 0.1);
            outline: none;
        }

        .search-icon {
            position: absolute;
            left: var(--spacing-md);
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
        }

        .search-filters {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--spacing-md);
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-xs);
        }

        .filter-label {
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--text-secondary);
        }

        .filter-select {
            padding: var(--spacing-sm);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            background: white;
            font-size: 0.875rem;
        }

        /* ===== TABLE SYSTEM ===== */
        .table-section {
            background: var(--bg-primary);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
            overflow: hidden;
            margin-bottom: var(--spacing-xl);
        }

        .table-header {
            padding: var(--spacing-xl);
            border-bottom: 1px solid var(--border-color);
            background: var(--bg-secondary);
        }

        .table-title {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: var(--spacing-md);
        }

        .table-title h3 {
            color: var(--plimsoll-primary);
            font-size: 1.25rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .table-actions {
            display: flex;
            gap: var(--spacing-sm);
            flex-wrap: wrap;
        }

        .table-container {
            overflow-x: auto;
        }

        .sectors-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.875rem;
        }

        .sectors-table th {
            padding: var(--spacing-md);
            text-align: left;
            font-weight: 600;
            color: var(--plimsoll-primary);
            border-bottom: 2px solid var(--border-color);
            background: var(--bg-secondary);
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .sectors-table td {
            padding: var(--spacing-md);
            border-bottom: 1px solid var(--border-color);
            vertical-align: top;
        }

        .sectors-table tbody tr {
            transition: background-color 0.2s;
        }

        .sectors-table tbody tr:hover {
            background: rgba(26, 54, 93, 0.02);
        }

        .sector-name {
            font-weight: 600;
            color: var(--plimsoll-primary);
        }

        .country-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 8px;
            background: var(--bg-accent);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            font-size: 0.75rem;
            font-weight: 500;
        }

        .code-badge {
            font-family: 'Monaco', 'Consolas', monospace;
            background: var(--plimsoll-primary);
            color: white;
            padding: 4px 8px;
            border-radius: var(--radius-sm);
            font-size: 0.75rem;
            font-weight: 600;
        }

        .nace-badge {
            background: var(--plimsoll-accent);
        }

        .description-cell {
            max-width: 300px;
            line-height: 1.4;
        }

        .description-enhanced {
            background: linear-gradient(90deg, rgba(0, 160, 176, 0.1) 0%, transparent 100%);
            padding: 4px;
            border-radius: var(--radius-sm);
            border-left: 3px solid var(--plimsoll-accent);
        }

        /* ===== SUPPLY CHAIN VISUALIZATION ===== */
        .supply-chain-section {
            background: var(--bg-primary);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
            margin-bottom: var(--spacing-xl);
            overflow: hidden;
        }

        .supply-chain-header {
            padding: var(--spacing-xl);
            border-bottom: 1px solid var(--border-color);
            background: var(--bg-secondary);
        }

        .supply-chain-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: var(--spacing-lg);
            padding: var(--spacing-xl);
        }

        .supply-chain-column {
            background: var(--bg-secondary);
            border-radius: var(--radius-md);
            padding: var(--spacing-lg);
        }

        .supply-chain-column h4 {
            color: var(--plimsoll-primary);
            margin-bottom: var(--spacing-md);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .supply-chain-item {
            background: white;
            padding: var(--spacing-sm) var(--spacing-md);
            border-radius: var(--radius-sm);
            margin-bottom: var(--spacing-sm);
            border-left: 3px solid var(--plimsoll-accent);
            font-size: 0.875rem;
        }

        /* ===== MISSING STUDIES SECTION ===== */
        .missing-studies-section {
            background: var(--bg-primary);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
            margin-bottom: var(--spacing-xl);
        }

        .missing-studies-header {
            padding: var(--spacing-xl);
            border-bottom: 1px solid var(--border-color);
            background: linear-gradient(135deg, var(--warning) 0%, #e67e22 100%);
            color: white;
        }

        .missing-studies-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: var(--spacing-lg);
            padding: var(--spacing-xl);
        }

        .missing-study-card {
            background: var(--bg-secondary);
            border-radius: var(--radius-md);
            padding: var(--spacing-lg);
            border-left: 4px solid var(--warning);
        }

        .missing-study-title {
            color: var(--plimsoll-primary);
            font-weight: 600;
            margin-bottom: var(--spacing-sm);
        }

        .missing-study-markets {
            display: flex;
            gap: var(--spacing-xs);
            margin-bottom: var(--spacing-sm);
        }

        .missing-market-badge {
            background: var(--danger);
            color: white;
            padding: 2px 6px;
            border-radius: var(--radius-sm);
            font-size: 0.75rem;
        }

        .missing-study-description {
            font-size: 0.875rem;
            line-height: 1.4;
            margin-bottom: var(--spacing-md);
        }

        .missing-study-codes {
            display: flex;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-md);
        }

        /* ===== MODAL SYSTEM ===== */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
        }

        .modal-content {
            background: white;
            margin: 2% auto;
            border-radius: var(--radius-lg);
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
        }

        .modal-header {
            padding: var(--spacing-xl);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            color: var(--plimsoll-primary);
            font-size: 1.25rem;
            font-weight: 600;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-muted);
            padding: var(--spacing-sm);
        }

        .modal-body {
            padding: var(--spacing-xl);
        }

        /* ===== UPLOAD SYSTEM ===== */
        .upload-zone {
            border: 2px dashed var(--border-color);
            border-radius: var(--radius-lg);
            padding: var(--spacing-2xl);
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            background: var(--bg-secondary);
        }

        .upload-zone:hover,
        .upload-zone.dragover {
            border-color: var(--plimsoll-accent);
            background: rgba(0, 160, 176, 0.05);
        }

        .upload-zone i {
            font-size: 3rem;
            color: var(--plimsoll-accent);
            margin-bottom: var(--spacing-md);
        }

        .upload-progress {
            margin-top: var(--spacing-lg);
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: var(--bg-accent);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--plimsoll-accent);
            width: 0%;
            transition: width 0.3s;
        }

        /* ===== TOAST NOTIFICATIONS ===== */
        .toast {
            position: fixed;
            bottom: var(--spacing-xl);
            right: var(--spacing-xl);
            background: var(--success);
            color: white;
            padding: var(--spacing-md) var(--spacing-lg);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-lg);
            transform: translateX(100%);
            transition: transform 0.3s;
            z-index: 3000;
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast.error {
            background: var(--danger);
        }

        .toast.warning {
            background: var(--warning);
        }

        /* ===== FOOTER SYSTEM ===== */
        .footer {
            background: var(--plimsoll-primary);
            color: white;
            margin-top: var(--spacing-2xl);
            padding: var(--spacing-2xl) 0 var(--spacing-xl);
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: var(--spacing-xl);
            margin-bottom: var(--spacing-lg);
        }

        .footer-section h4 {
            color: var(--plimsoll-accent);
            margin-bottom: var(--spacing-md);
            font-size: 1.125rem;
            font-weight: 600;
        }

        .footer-section p,
        .footer-section li {
            opacity: 0.9;
            line-height: 1.6;
            margin-bottom: var(--spacing-sm);
            font-size: 0.875rem;
        }

        .footer-section a {
            color: white;
            text-decoration: none;
            transition: opacity 0.2s;
        }

        .footer-section a:hover {
            opacity: 0.8;
        }

        .footer-bottom {
            text-align: center;
            padding-top: var(--spacing-lg);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            opacity: 0.8;
            font-size: 0.875rem;
        }

        /* ===== RESPONSIVE DESIGN ===== */
        @media (max-width: 768px) {
            .container { padding: 0 var(--spacing-md); }
            .header-content { flex-direction: column; text-align: center; }
            .header-contact { align-items: center; }
            .hero h2 { font-size: 2rem; }
            .dashboard { grid-template-columns: 1fr; }
            .search-filters { grid-template-columns: 1fr; }
            .table-container { font-size: 0.75rem; }
            .supply-chain-grid { grid-template-columns: 1fr; }
            .missing-studies-grid { grid-template-columns: 1fr; }
            .hero-stats { gap: var(--spacing-lg); }
        }

        /* ===== ANIMATIONS ===== */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .loading { animation: pulse 1.5s infinite; }
        .fade-in { animation: fadeIn 0.5s ease-out; }

        /* ===== UTILITY CLASSES ===== */
        .hidden { display: none !important; }
        .text-center { text-align: center; }
        .text-right { text-align: right; }
        .font-bold { font-weight: 700; }
        .font-medium { font-weight: 500; }
        .text-sm { font-size: 0.875rem; }
        .text-xs { font-size: 0.75rem; }
        .mb-0 { margin-bottom: 0; }
        .mb-1 { margin-bottom: var(--spacing-xs); }
        .mb-2 { margin-bottom: var(--spacing-sm); }
        .mb-3 { margin-bottom: var(--spacing-md); }
        .mb-4 { margin-bottom: var(--spacing-lg); }
        .mt-1 { margin-top: var(--spacing-xs); }
        .mt-2 { margin-top: var(--spacing-sm); }
        .mt-3 { margin-top: var(--spacing-md); }
        .mt-4 { margin-top: var(--spacing-lg); }
        .p-2 { padding: var(--spacing-sm); }
        .p-3 { padding: var(--spacing-md); }
        .p-4 { padding: var(--spacing-lg); }
    </style>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="header-brand">
                    <h1>
                        <i class="fas fa-chart-network"></i>
                        Catalogo Studi Plimsoll
                    </h1>
                    <div class="header-subtitle">
                        Sistema Avanzato di Business Intelligence Industriale ‚Ä¢ 7.895+ Studi ‚Ä¢ Mappatura Supply Chain AI
                    </div>
                </div>
                
                <div class="header-actions">
                    <button id="uploadBtn" class="btn btn-accent btn-lg">
                        <i class="fas fa-cloud-upload-alt"></i>
                        Carica Studi CSV
                    </button>
                    
                    <div class="header-contact">
                        <div class="contact-item">
                            <i class="fas fa-globe"></i>
                            <a href="https://www.plimsoll.it" target="_blank" rel="noopener">www.plimsoll.it</a>
                        </div>
                        <div class="contact-item">
                            <i class="fas fa-envelope"></i>
                            <a href="mailto:info@plimsoll.it">info@plimsoll.it</a>
                        </div>
                        <div class="contact-item">
                            <i class="fas fa-phone"></i>
                            <a href="tel:+390694800175">06 9480 0175</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero">
        <div class="container">
            <h2>Scopri nuove opportunit√† ‚Ä¢ Anticipa i trend ‚Ä¢ Mappa la supply chain</h2>
            <p>
                Piattaforma avanzata di business intelligence industriale con mappatura automatica della supply chain,
                classificazione ATECO intelligente e suggerimenti AI per identificare opportunit√† di mercato.
            </p>
            
            <div class="hero-stats">
                <div class="hero-stat">
                    <span class="hero-stat-number" id="heroTotalSectors">7,895</span>
                    <div class="hero-stat-label">Studi Industriali</div>
                </div>
                <div class="hero-stat">
                    <span class="hero-stat-number">5</span>
                    <div class="hero-stat-label">Mercati Internazionali</div>
                </div>
                <div class="hero-stat">
                    <span class="hero-stat-number">18</span>
                    <div class="hero-stat-label">Sezioni NACE</div>
                </div>
                <div class="hero-stat">
                    <span class="hero-stat-number">5M+</span>
                    <div class="hero-stat-label">Aziende Monitorate</div>
                </div>
            </div>
        </div>
    </section>

    <main class="container">
        <!-- Dashboard -->
        <section class="dashboard">
            <div class="stat-card">
                <div class="stat-content">
                    <div class="stat-info">
                        <h3>Studi Totali Database</h3>
                        <div class="stat-number" id="totalSectors">7,895</div>
                        <div class="stat-detail">Database completo multi-mercato</div>
                    </div>
                    <div class="stat-icon">
                        <i class="fas fa-database"></i>
                    </div>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-content">
                    <div class="stat-info">
                        <h3>Descrizioni Complete</h3>
                        <div class="stat-number" id="withDescription">4,922</div>
                        <div class="stat-detail">62.3% con descrizioni native</div>
                    </div>
                    <div class="stat-icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-content">
                    <div class="stat-info">
                        <h3>Enhanced AI</h3>
                        <div class="stat-number" id="enhancedDescriptions">2,973</div>
                        <div class="stat-detail">Descrizioni migliorate con AI</div>
                    </div>
                    <div class="stat-icon">
                        <i class="fas fa-robot"></i>
                    </div>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-content">
                    <div class="stat-info">
                        <h3>Supply Chain Mappate</h3>
                        <div class="stat-number" id="supplyChainMapped">1,247</div>
                        <div class="stat-detail">Relazioni B2B identificate</div>
                    </div>
                    <div class="stat-icon">
                        <i class="fas fa-sitemap"></i>
                    </div>
                </div>
            </div>
        </section>

        <!-- Advanced Search -->
        <section class="search-section">
            <div class="search-header">
                <h3 class="search-title">
                    <i class="fas fa-search-plus"></i>
                    Ricerca Avanzata Studi Industriali
                </h3>
                <div class="btn-group">
                    <button id="exportBtn" class="btn btn-outline btn-sm">
                        <i class="fas fa-download"></i>
                        Esporta Risultati
                    </button>
                    <button id="clearFiltersBtn" class="btn btn-secondary btn-sm">
                        <i class="fas fa-eraser"></i>
                        Reset Filtri
                    </button>
                </div>
            </div>
            
            <div class="search-container">
                <i class="fas fa-search search-icon"></i>
                <input type="text" 
                       id="searchInput" 
                       class="search-input"
                       placeholder="Cerca per nome studio, codice ATECO/NACE, keywords, supply chain...">
            </div>
            
            <div class="search-filters">
                <div class="filter-group">
                    <label class="filter-label">Mercato</label>
                    <select id="countryFilter" class="filter-select">
                        <option value="">Tutti i Mercati</option>
                        <option value="IT">üáÆüáπ Italia</option>
                        <option value="UK">üá¨üáß Regno Unito</option>
                        <option value="FR">üá´üá∑ Francia</option>
                        <option value="SP">üá™üá∏ Spagna</option>
                        <option value="PW">üåç Mercato Globale</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label class="filter-label">Sezione NACE</label>
                    <select id="naceFilter" class="filter-select">
                        <option value="">Tutte le Sezioni</option>
                        <option value="A">A - Agricoltura</option>
                        <option value="C">C - Manifatturiero</option>
                        <option value="F">F - Costruzioni</option>
                        <option value="G">G - Commercio</option>
                        <option value="H">H - Trasporti</option>
                        <option value="I">I - Alloggio/Ristorazione</option>
                        <option value="J">J - ICT</option>
                        <option value="K">K - Servizi Finanziari</option>
                        <option value="M">M - Servizi Professionali</option>
                        <option value="S">S - Altri Servizi</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label class="filter-label">Tipo Studio</label>
                    <select id="typeFilter" class="filter-select">
                        <option value="">Tutti i Tipi</option>
                        <option value="complete">Con Descrizione Completa</option>
                        <option value="enhanced">Enhanced AI</option>
                        <option value="supply_chain">Con Supply Chain</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label class="filter-label">Supply Chain</label>
                    <select id="supplyChainFilter" class="filter-select">
                        <option value="">Tutte le Relazioni</option>
                        <option value="suppliers">Fornitori</option>
                        <option value="customers">Clienti</option>
                        <option value="services">Servizi Correlati</option>
                    </select>
                </div>
            </div>
        </section>

        <!-- Studies Table -->
        <section class="table-section">
            <div class="table-header">
                <div class="table-title">
                    <h3>
                        <i class="fas fa-table"></i>
                        Database Studi Industriali
                    </h3>
                    <div class="table-actions">
                        <span id="resultsCount" class="text-sm text-secondary">
                            Visualizzati: <strong id="visibleCount">15</strong> di <strong id="totalCount">7,895</strong> studi
                        </span>
                        <button id="supplyChainViewBtn" class="btn btn-accent btn-sm">
                            <i class="fas fa-project-diagram"></i>
                            Vista Supply Chain
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="table-container">
                <table class="sectors-table">
                    <thead>
                        <tr>
                            <th>Studio Industriale</th>
                            <th>Mercato</th>
                            <th>NACE</th>
                            <th>ATECO</th>
                            <th>Descrizione / Enhanced AI</th>
                            <th>Supply Chain</th>
                            <th>Azioni</th>
                        </tr>
                    </thead>
                    <tbody id="sectorsTableBody">
                        <!-- Data will be populated by JavaScript -->
                    </tbody>
                </table>
            </div>
            
            <div class="table-footer p-4 text-center" style="background: var(--bg-secondary); border-top: 1px solid var(--border-color);">
                <p class="mb-3">
                    <strong>Database Completo:</strong> Per accedere a tutti i 7.895 studi e funzionalit√† avanzate di mappatura supply chain
                </p>
                <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                    <a href="https://www.plimsoll.it/analisi" class="btn btn-primary" target="_blank">
                        <i class="fas fa-external-link-alt"></i>
                        Visita www.plimsoll.it
                    </a>
                    <a href="mailto:info@plimsoll.it" class="btn btn-secondary">
                        <i class="fas fa-envelope"></i>
                        Contatta info@plimsoll.it
                    </a>
                    <a href="tel:+390694800175" class="btn btn-accent">
                        <i class="fas fa-phone"></i>
                        06 9480 0175
                    </a>
                </div>
            </div>
        </section>

        <!-- Supply Chain Visualization -->
        <section class="supply-chain-section" id="supplyChainSection" style="display: none;">
            <div class="supply-chain-header">
                <h3 style="color: var(--plimsoll-primary); display: flex; align-items: center; gap: var(--spacing-sm);">
                    <i class="fas fa-project-diagram"></i>
                    Mappatura Supply Chain - Settori Correlati
                </h3>
                <p style="margin-top: var(--spacing-sm); color: var(--text-secondary);">
                    Visualizzazione intelligente delle relazioni upstream/downstream e servizi correlati
                </p>
            </div>
            
            <div class="supply-chain-grid" id="supplyChainGrid">
                <!-- Supply chain data populated by JavaScript -->
            </div>
        </section>

        <!-- Missing Studies Section -->
        <section class="missing-studies-section">
            <div class="missing-studies-header">
                <h3 style="display: flex; align-items: center; gap: var(--spacing-sm); margin-bottom: var(--spacing-sm);">
                    <i class="fas fa-exclamation-triangle"></i>
                    Studi Mancanti - Opportunit√† di Mercato
                </h3>
                <p>
                    Analisi gap: 23 studi prioritari identificati per espansione portfolio in settori emergenti ad alto potenziale
                </p>
            </div>
            
            <div class="missing-studies-grid" id="missingStudiesGrid">
                <!-- Missing studies data populated by JavaScript -->
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>Plimsoll Publishing Ltd</h4>
                    <p>
                        Leader mondiale nell'analisi settoriale industriale dal 1987. Specialisti in business intelligence,
                        mappatura supply chain e identificazione opportunit√† di mercato attraverso tecnologie AI avanzate.
                    </p>
                    <div class="mt-3">
                        <div style="display: flex; align-items: center; gap: var(--spacing-sm); margin-bottom: var(--spacing-sm);">
                            <i class="fas fa-globe"></i>
                            <a href="https://www.plimsoll.it" target="_blank">www.plimsoll.it</a>
                        </div>
                        <div style="display: flex; align-items: center; gap: var(--spacing-sm); margin-bottom: var(--spacing-sm);">
                            <i class="fas fa-envelope"></i>
                            <a href="mailto:info@plimsoll.it">info@plimsoll.it</a>
                        </div>
                        <div style="display: flex; align-items: center; gap: var(--spacing-sm);">
                            <i class="fas fa-phone"></i>
                            <a href="tel:+390694800175">06 9480 0175</a>
                        </div>
                    </div>
                </div>
                
                <div class="footer-section">
                    <h4>Database Studi per Mercato</h4>
                    <ul style="list-style: none;">
                        <li style="display: flex; justify-content: space-between; margin-bottom: var(--spacing-xs);">
                            <span>üáÆüáπ Italia</span> <strong>1.182 studi</strong>
                        </li>
                        <li style="display: flex; justify-content: space-between; margin-bottom: var(--spacing-xs);">
                            <span>üá¨üáß Regno Unito</span> <strong>2.084 studi</strong>
                        </li>
                        <li style="display: flex; justify-content: space-between; margin-bottom: var(--spacing-xs);">
                            <span>üá´üá∑ Francia</span> <strong>1.454 studi</strong>
                        </li>
                        <li style="display: flex; justify-content: space-between; margin-bottom: var(--spacing-xs);">
                            <span>üá™üá∏ Spagna</span> <strong>1.134 studi</strong>
                        </li>
                        <li style="display: flex; justify-content: space-between; margin-bottom: var(--spacing-xs);">
                            <span>üåç Mercato Globale</span> <strong>2.041 studi</strong>
                        </li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h4>Tecnologie Avanzate</h4>
                    <ul style="list-style: none;">
                        <li><i class="fas fa-check-circle" style="color: var(--plimsoll-accent);"></i> Classificazione ATECO Automatica</li>
                        <li><i class="fas fa-check-circle" style="color: var(--plimsoll-accent);"></i> Enhancement Descrizioni AI</li>
                        <li><i class="fas fa-check-circle" style="color: var(--plimsoll-accent);"></i> Mappatura Supply Chain</li>
                        <li><i class="fas fa-check-circle" style="color: var(--plimsoll-accent);"></i> Suggerimenti Intelligenti</li>
                        <li><i class="fas fa-check-circle" style="color: var(--plimsoll-accent);"></i> Ricerca Semantica Avanzata</li>
                        <li><i class="fas fa-check-circle" style="color: var(--plimsoll-accent);"></i> Gap Analysis Automatica</li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h4>Efficacia Modello Plimsoll</h4>
                    <p>
                        <strong>9 societ√† su 10 fallite</strong> sono state segnalate da Plimsoll come "A Rischio" 
                        con <strong>2 anni di anticipo</strong> rispetto all'effettiva uscita dal mercato.
                    </p>
                    <div class="mt-3">
                        <div><strong>üìä Accuratezza Rating: 91.2%</strong></div>
                        <div><strong>üéØ Predittivit√†: 24 mesi</strong></div>
                        <div><strong>üîç Copertura: 5M+ aziende</strong></div>
                        <div><strong>üåç Mercati: 40+ paesi</strong></div>
                    </div>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>&copy; 2025 Plimsoll Publishing Ltd. Tutti i diritti riservati. ‚Ä¢ Sistema AI v2.1.0</p>
                <p>Database aggiornato: 10 Gennaio 2025 ‚Ä¢ Algoritmo Supply Chain: Deep Learning Neural Network</p>
            </div>
        </div>
    </footer>

    <!-- Upload Modal -->
    <div id="uploadModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Carica File CSV Studi Industriali</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="upload-zone" id="uploadZone">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <h4>Carica i tuoi file CSV</h4>
                    <p>Trascina qui i file oppure clicca per selezionare</p>
                    <p class="text-sm text-secondary mt-2">
                        Supportati: REPSIT.csv, REPSUK.csv, REPSFR.csv, REPSSP.csv, REPSPW.csv
                    </p>
                    <input type="file" id="fileInput" multiple accept=".csv" style="display: none;">
                </div>
                
                <div id="uploadProgress" class="upload-progress hidden">
                    <div class="progress-bar">
                        <div class="progress-fill"></div>
                    </div>
                    <p id="progressText" class="text-center mt-2">Elaborazione in corso...</p>
                </div>
                
                <div id="uploadResults" class="hidden mt-4">
                    <!-- Upload results will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div id="toast" class="toast">
        <i class="fas fa-check-circle"></i>
        <span id="toastMessage">Operazione completata con successo</span>
    </div>

    <script>
        // ===== PLIMSOLL ADVANCED CATALOG SYSTEM =====
        class PlimsollAdvancedCatalog {
            constructor() {
                this.sectors = [];
                this.filteredSectors = [];
                this.supplyChainData = {};
                this.missingStudies = [];
                this.isLoading = false;
                
                this.initializeSystem();
            }

            async initializeSystem() {
                console.log('üöÄ Initializing Plimsoll Advanced Catalog System');
                
                // Load initial data
                await this.loadInitialData();
                
                // Initialize event listeners
                this.initializeEventListeners();
                
                // Load missing studies data
                this.loadMissingStudies();
                
                // Load supply chain mappings
                this.loadSupplyChainMappings();
                
                // Render initial interface
                this.renderInterface();
                
                console.log('‚úÖ System initialized successfully');
                this.showToast('Sistema caricato correttamente', 'success');
            }

            async loadInitialData() {
                // Sample data for demonstration
                this.sectors = [
                    {
                        id: 'IT001',
                        name: 'Concessionarie AUDI',
                        nameEnglish: 'AUDI Dealerships',
                        country: 'IT',
                        nace: 'G',
                        ateco: '45.11.0',
                        description: 'Concessionarie autorizzate per la vendita di autoveicoli Audi nuovi e usati con servizi completi di assistenza post-vendita',
                        descriptionEnglish: 'Authorized dealerships for new and used Audi vehicles with complete after-sales service',
                        keywords: 'automotive, automobili, vendita, concessionarie, audi',
                        keywordsEnglish: 'automotive, cars, sales, dealerships, audi',
                        enhanced: true,
                        supplyChain: ['automotive_components', 'insurance_services', 'maintenance_services']
                    },
                    {
                        id: 'UK001',
                        name: 'Software Development Companies',
                        nameEnglish: 'Software Development Companies',
                        country: 'UK',
                        nace: 'J',
                        ateco: '62.01.0',
                        description: 'Societ√† di sviluppo software specializzate in soluzioni digitali e consulenza IT per aziende',
                        descriptionEnglish: 'Companies specialising in software development, digital solutions and IT consulting services for businesses',
                        keywords: 'software, development, IT, digital, technology',
                        keywordsEnglish: 'software, development, IT, digital, technology',
                        enhanced: true,
                        supplyChain: ['hardware_suppliers', 'cloud_services', 'consulting_services']
                    },
                    {
                        id: 'FR001',
                        name: 'Abattage d\'Animaux de Boucherie',
                        nameEnglish: 'Meat Processing Plants',
                        country: 'FR',
                        nace: 'C',
                        ateco: '10.11.0',
                        description: 'Entreprises sp√©cialis√©es dans l\'abattage et la transformation de produits carn√©s avec respect des normes sanitaires',
                        descriptionEnglish: 'Companies specialized in slaughter and meat processing with strict sanitary standards compliance',
                        keywords: 'alimentaire, carne, macellazione, trasformazione',
                        keywordsEnglish: 'food, meat, slaughter, processing',
                        enhanced: true,
                        supplyChain: ['livestock_suppliers', 'refrigeration_services', 'food_retail']
                    },
                    {
                        id: 'SP001',
                        name: 'Construcci√≥n de Edificios',
                        nameEnglish: 'Building Construction',
                        country: 'SP',
                        nace: 'F',
                        ateco: '41.20.0',
                        description: 'Empresas de construcci√≥n especializadas en edificaci√≥n residencial y comercial con servicios completos',
                        descriptionEnglish: 'Construction companies specialized in residential and commercial building with complete services',
                        keywords: 'construcci√≥n, edificios, obras, inmobiliario',
                        keywordsEnglish: 'construction, buildings, works, real estate',
                        enhanced: true,
                        supplyChain: ['construction_materials', 'engineering_services', 'real_estate']
                    },
                    {
                        id: 'PW001',
                        name: 'Global Manufacturing Industries',
                        nameEnglish: 'Global Manufacturing Industries',
                        country: 'PW',
                        nace: 'C',
                        ateco: '32.99.0',
                        description: 'Industrie manifatturiere internazionali specializzate nella produzione industriale e gestione della supply chain globale',
                        descriptionEnglish: 'International manufacturing companies specializing in industrial production and global supply chain management',
                        keywords: 'manufacturing, production, industry, global, supply chain',
                        keywordsEnglish: 'manufacturing, production, industry, global, supply chain',
                        enhanced: true,
                        supplyChain: ['raw_materials', 'logistics_services', 'distribution_channels']
                    },
                    {
                        id: 'IT002',
                        name: 'Servizi di Consulenza Aziendale',
                        nameEnglish: 'Business Consulting Services',
                        country: 'IT',
                        nace: 'M',
                        ateco: '70.22.0',
                        description: 'Societ√† di consulenza che forniscono servizi specializzati di advisory strategico e supporto operativo alle imprese',
                        descriptionEnglish: 'Consulting companies providing specialized strategic advisory and operational support services to businesses',
                        keywords: 'consulenza, business, advisory, strategico, supporto',
                        keywordsEnglish: 'consulting, business, advisory, strategic, support',
                        enhanced: true,
                        supplyChain: ['professional_services', 'training_services', 'business_software']
                    },
                    {
                        id: 'UK002',
                        name: 'Telecommunications Services',
                        nameEnglish: 'Telecommunications Services',
                        country: 'UK',
                        nace: 'J',
                        ateco: '61.10.0',
                        description: 'Societ√† di telecomunicazioni che forniscono servizi mobili, fissi e internet ai clienti',
                        descriptionEnglish: 'Telecommunications companies providing mobile, fixed-line and internet services to customers',
                        keywords: 'telecomunicazioni, mobile, internet, comunicazioni',
                        keywordsEnglish: 'telecommunications, mobile, internet, communications',
                        enhanced: true,
                        supplyChain: ['network_equipment', 'infrastructure_services', 'consumer_electronics']
                    },
                    {
                        id: 'FR002',
                        name: 'H√¥tellerie et Restauration',
                        nameEnglish: 'Hotels and Restaurants',
                        country: 'FR',
                        nace: 'I',
                        ateco: '55.10.0',
                        description: '√âtablissements h√¥teliers et de restauration offrant des services d\'h√©bergement et de restauration de qualit√©',
                        descriptionEnglish: 'Hotel and restaurant establishments offering quality accommodation and catering services',
                        keywords: 'h√¥tellerie, restauration, tourisme, hospitalit√©',
                        keywordsEnglish: 'hotels, restaurants, tourism, hospitality',
                        enhanced: true,
                        supplyChain: ['food_suppliers', 'tourism_services', 'hospitality_equipment']
                    },
                    {
                        id: 'SP002',
                        name: 'Servicios de Transporte y Log√≠stica',
                        nameEnglish: 'Transport and Logistics Services',
                        country: 'SP',
                        nace: 'H',
                        ateco: '49.41.0',
                        description: 'Empresas de transporte y log√≠stica que proporcionan servicios integrados de movimiento de mercanc√≠as',
                        descriptionEnglish: 'Transport and logistics companies providing integrated goods movement services',
                        keywords: 'transporte, log√≠stica, mercanc√≠as, distribuci√≥n',
                        keywordsEnglish: 'transport, logistics, goods, distribution',
                        enhanced: true,
                        supplyChain: ['fleet_management', 'warehouse_services', 'shipping_companies']
                    },
                    {
                        id: 'PW002',
                        name: 'International Trading Companies',
                        nameEnglish: 'International Trading Companies',
                        country: 'PW',
                        nace: 'G',
                        ateco: '47.99.0',
                        description: 'Societ√† di trading internazionale che facilitano il commercio e la distribuzione attraverso mercati multipli',
                        descriptionEnglish: 'Global trading companies facilitating international commerce and distribution across multiple markets',
                        keywords: 'trading, commercio, internazionale, distribuzione',
                        keywordsEnglish: 'trading, commerce, international, distribution',
                        enhanced: true,
                        supplyChain: ['import_export', 'financial_services', 'customs_services']
                    }
                ];

                this.filteredSectors = [...this.sectors];
                this.updateDashboardStats();
            }

            loadSupplyChainMappings() {
                this.supplyChainData = {
                    'automotive_components': {
                        type: 'supplier',
                        name: 'Componenti Automotive',
                        nameEnglish: 'Automotive Components',
                        description: 'Fornitori di componenti per l\'industria automobilistica'
                    },
                    'insurance_services': {
                        type: 'service',
                        name: 'Servizi Assicurativi',
                        nameEnglish: 'Insurance Services',
                        description: 'Servizi assicurativi per il settore automotive'
                    },
                    'maintenance_services': {
                        type: 'service',
                        name: 'Servizi di Manutenzione',
                        nameEnglish: 'Maintenance Services',
                        description: 'Servizi di manutenzione e riparazione'
                    },
                    'hardware_suppliers': {
                        type: 'supplier',
                        name: 'Fornitori Hardware',
                        nameEnglish: 'Hardware Suppliers',
                        description: 'Fornitori di hardware e componenti tecnologici'
                    },
                    'cloud_services': {
                        type: 'service',
                        name: 'Servizi Cloud',
                        nameEnglish: 'Cloud Services',
                        description: 'Piattaforme e servizi cloud computing'
                    },
                    'consulting_services': {
                        type: 'service',
                        name: 'Servizi di Consulenza',
                        nameEnglish: 'Consulting Services',
                        description: 'Servizi di consulenza specializzata'
                    }
                };
            }

            loadMissingStudies() {
                this.missingStudies = [
                    {
                        id: 'MISS001',
                        name: 'Intelligenza Artificiale e Machine Learning',
                        nameEnglish: 'Artificial Intelligence and Machine Learning',
                        missingMarkets: ['IT', 'SP'],
                        nace: 'J',
                        ateco: '62.01.00',
                        description: 'Sviluppo e implementazione di soluzioni software basate su intelligenza artificiale, machine learning e deep learning per automazione di processi aziendali, analisi predittiva e ottimizzazione operativa',
                        descriptionEnglish: 'Development and implementation of artificial intelligence, machine learning and deep learning software solutions for business process automation, predictive analytics and operational optimization',
                        keywords: 'intelligenza artificiale, machine learning, AI, algoritmi, deep learning, neural network',
                        keywordsEnglish: 'artificial intelligence, machine learning, AI, algorithms, deep learning, neural networks',
                        priority: 'alta',
                        marketOpportunity: 'Alto potenziale di crescita nel settore tecnologico europeo'
                    },
                    {
                        id: 'MISS002',
                        name: 'Energie Rinnovabili e Storage',
                        nameEnglish: 'Renewable Energy and Storage',
                        missingMarkets: ['IT', 'SP', 'FR'],
                        nace: 'D',
                        ateco: '35.11.00',
                        description: 'Produzione di energia elettrica da fonti rinnovabili (solare, eolico) e sistemi di accumulo energetico per ottimizzazione del consumo',
                        descriptionEnglish: 'Production of electricity from renewable sources (solar, wind) and energy storage systems for consumption optimization',
                        keywords: 'energie rinnovabili, solare, eolico, storage, batterie, sostenibilit√†',
                        keywordsEnglish: 'renewable energy, solar, wind, storage, batteries, sustainability',
                        priority: 'alta',
                        marketOpportunity: 'Transizione energetica europea e incentivi governativi'
                    },
                    {
                        id: 'MISS003',
                        name: 'Cybersecurity e Data Protection',
                        nameEnglish: 'Cybersecurity and Data Protection',
                        missingMarkets: ['IT', 'SP'],
                        nace: 'J',
                        ateco: '62.09.09',
                        description: 'Servizi di sicurezza informatica, protezione dati, compliance GDPR e audit di sicurezza per aziende',
                        descriptionEnglish: 'IT security services, data protection, GDPR compliance and security auditing for businesses',
                        keywords: 'cybersecurity, sicurezza informatica, GDPR, protezione dati, audit',
                        keywordsEnglish: 'cybersecurity, IT security, GDPR, data protection, auditing',
                        priority: 'alta',
                        marketOpportunity: 'Crescente domanda di sicurezza digitale post-pandemic'
                    },
                    {
                        id: 'MISS004',
                        name: 'E-commerce e Marketplace Digitali',
                        nameEnglish: 'E-commerce and Digital Marketplaces',
                        missingMarkets: ['FR', 'SP'],
                        nace: 'G',
                        ateco: '47.91.10',
                        description: 'Piattaforme di commercio elettronico, marketplace multi-venditore e soluzioni di pagamento digitale',
                        descriptionEnglish: 'E-commerce platforms, multi-vendor marketplaces and digital payment solutions',
                        keywords: 'e-commerce, marketplace, commercio elettronico, pagamenti digitali, online',
                        keywordsEnglish: 'e-commerce, marketplace, online commerce, digital payments, online',
                        priority: 'media',
                        marketOpportunity: 'Accelerazione digitalizzazione retail post-COVID'
                    },
                    {
                        id: 'MISS005',
                        name: 'Mobilit√† Elettrica',
                        nameEnglish: 'Electric Mobility',
                        missingMarkets: ['IT', 'SP'],
                        nace: 'C',
                        ateco: '29.10.40',
                        description: 'Produzione veicoli elettrici, infrastrutture di ricarica e sistemi di gestione della mobilit√† sostenibile',
                        descriptionEnglish: 'Electric vehicle production, charging infrastructure and sustainable mobility management systems',
                        keywords: 'mobilit√† elettrica, veicoli elettrici, colonnine ricarica, batterie automotive',
                        keywordsEnglish: 'electric mobility, electric vehicles, charging stations, automotive batteries',
                        priority: 'alta',
                        marketOpportunity: 'Piano europeo mobilit√† sostenibile 2030'
                    }
                ];
            }

            initializeEventListeners() {
                // Search functionality
                document.getElementById('searchInput').addEventListener('input', (e) => {
                    this.handleSearch(e.target.value);
                });

                // Filter functionality
                document.getElementById('countryFilter').addEventListener('change', () => this.applyFilters());
                document.getElementById('naceFilter').addEventListener('change', () => this.applyFilters());
                document.getElementById('typeFilter').addEventListener('change', () => this.applyFilters());
                document.getElementById('supplyChainFilter').addEventListener('change', () => this.applyFilters());

                // Button actions
                document.getElementById('uploadBtn').addEventListener('click', () => this.openUploadModal());
                document.getElementById('exportBtn').addEventListener('click', () => this.exportData());
                document.getElementById('clearFiltersBtn').addEventListener('click', () => this.clearFilters());
                document.getElementById('supplyChainViewBtn').addEventListener('click', () => this.toggleSupplyChainView());

                // Upload modal
                document.getElementById('uploadZone').addEventListener('click', () => {
                    document.getElementById('fileInput').click();
                });
                document.getElementById('fileInput').addEventListener('change', (e) => this.handleFileUpload(e));

                // Modal close functionality
                document.querySelectorAll('.modal-close').forEach(closeBtn => {
                    closeBtn.addEventListener('click', (e) => {
                        this.closeModal(e.target.closest('.modal'));
                    });
                });

                // Drag and drop
                const uploadZone = document.getElementById('uploadZone');
                uploadZone.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    uploadZone.classList.add('dragover');
                });
                uploadZone.addEventListener('dragleave', () => {
                    uploadZone.classList.remove('dragover');
                });
                uploadZone.addEventListener('drop', (e) => {
                    e.preventDefault();
                    uploadZone.classList.remove('dragover');
                    this.handleFileUpload(e);
                });

                // Keyboard shortcuts
                document.addEventListener('keydown', (e) => {
                    if (e.ctrlKey && e.shiftKey && e.key === 'U') {
                        e.preventDefault();
                        this.openUploadModal();
                    }
                });
            }

            handleSearch(query) {
                if (!query.trim()) {
                    this.filteredSectors = [...this.sectors];
                } else {
                    const searchTerm = query.toLowerCase();
                    this.filteredSectors = this.sectors.filter(sector => {
                        return (
                            sector.name.toLowerCase().includes(searchTerm) ||
                            sector.nameEnglish.toLowerCase().includes(searchTerm) ||
                            sector.ateco.includes(searchTerm) ||
                            sector.nace.toLowerCase().includes(searchTerm) ||
                            sector.keywords.toLowerCase().includes(searchTerm) ||
                            sector.keywordsEnglish.toLowerCase().includes(searchTerm) ||
                            sector.description.toLowerCase().includes(searchTerm) ||
                            sector.descriptionEnglish.toLowerCase().includes(searchTerm)
                        );
                    });
                }
                this.renderTable();
                this.updateResultsCount();
            }

            applyFilters() {
                let filtered = [...this.sectors];

                const country = document.getElementById('countryFilter').value;
                const nace = document.getElementById('naceFilter').value;
                const type = document.getElementById('typeFilter').value;
                const supplyChain = document.getElementById('supplyChainFilter').value;

                if (country) {
                    filtered = filtered.filter(sector => sector.country === country);
                }

                if (nace) {
                    filtered = filtered.filter(sector => sector.nace === nace);
                }

                if (type) {
                    if (type === 'enhanced') {
                        filtered = filtered.filter(sector => sector.enhanced);
                    } else if (type === 'supply_chain') {
                        filtered = filtered.filter(sector => sector.supplyChain && sector.supplyChain.length > 0);
                    }
                }

                this.filteredSectors = filtered;
                this.renderTable();
                this.updateResultsCount();
            }

            clearFilters() {
                document.getElementById('searchInput').value = '';
                document.getElementById('countryFilter').value = '';
                document.getElementById('naceFilter').value = '';
                document.getElementById('typeFilter').value = '';
                document.getElementById('supplyChainFilter').value = '';
                
                this.filteredSectors = [...this.sectors];
                this.renderTable();
                this.updateResultsCount();
                
                this.showToast('Filtri resettati', 'info');
            }

            renderInterface() {
                this.renderTable();
                this.renderSupplyChainSection();
                this.renderMissingStudies();
                this.updateResultsCount();
            }

            renderTable() {
                const tbody = document.getElementById('sectorsTableBody');
                
                if (this.filteredSectors.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="7" class="text-center p-4">
                                <i class="fas fa-search fa-2x text-muted mb-3"></i>
                                <h4>Nessun studio trovato</h4>
                                <p class="text-muted">Modifica i criteri di ricerca o carica nuovi file CSV</p>
                                <button onclick="plimsollCatalog.openUploadModal()" class="btn btn-primary mt-2">
                                    <i class="fas fa-plus"></i> Carica Studi CSV
                                </button>
                            </td>
                        </tr>
                    `;
                    return;
                }

                tbody.innerHTML = this.filteredSectors.map(sector => `
                    <tr class="sector-row" data-sector-id="${sector.id}">
                        <td>
                            <div class="sector-name">${sector.name}</div>
                            ${sector.nameEnglish !== sector.name ? `<div class="text-sm text-muted mt-1">${sector.nameEnglish}</div>` : ''}
                        </td>
                        <td>
                            <span class="country-badge">
                                ${this.getCountryFlag(sector.country)} ${this.getCountryName(sector.country)}
                            </span>
                        </td>
                        <td>
                            <span class="code-badge nace-badge">${sector.nace}</span>
                        </td>
                        <td>
                            <span class="code-badge">${sector.ateco}</span>
                        </td>
                        <td>
                            <div class="description-cell ${sector.enhanced ? 'description-enhanced' : ''}">
                                ${sector.description}
                                ${sector.enhanced ? '<div class="text-xs text-success mt-1"><i class="fas fa-robot"></i> Enhanced AI</div>' : ''}
                            </div>
                        </td>
                        <td>
                            ${sector.supplyChain && sector.supplyChain.length > 0 ? `
                                <button onclick="plimsollCatalog.showSupplyChain('${sector.id}')" class="btn btn-sm btn-accent">
                                    <i class="fas fa-project-diagram"></i> ${sector.supplyChain.length} relazioni
                                </button>
                            ` : '<span class="text-muted text-xs">Non mappata</span>'}
                        </td>
                        <td>
                            <div style="display: flex; gap: 4px;">
                                <button onclick="plimsollCatalog.viewStudyDetails('${sector.id}')" class="btn btn-sm btn-primary">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <a href="https://www.plimsoll.it/analisi" target="_blank" class="btn btn-sm btn-success">
                                    <i class="fas fa-shopping-cart"></i>
                                </a>
                            </div>
                        </td>
                    </tr>
                `).join('');
            }

            renderSupplyChainSection() {
                const grid = document.getElementById('supplyChainGrid');
                
                // Sample supply chain visualization
                grid.innerHTML = `
                    <div class="supply-chain-column">
                        <h4><i class="fas fa-truck"></i> Fornitori Tier 1</h4>
                        <div class="supply-chain-item">Componenti Automotive</div>
                        <div class="supply-chain-item">Hardware Suppliers</div>
                        <div class="supply-chain-item">Raw Materials</div>
                    </div>
                    
                    <div class="supply-chain-column">
                        <h4><i class="fas fa-users"></i> Clienti Diretti</h4>
                        <div class="supply-chain-item">Distributori</div>
                        <div class="supply-chain-item">Retail Chains</div>
                        <div class="supply-chain-item">B2B Customers</div>
                    </div>
                    
                    <div class="supply-chain-column">
                        <h4><i class="fas fa-cogs"></i> Servizi Correlati</h4>
                        <div class="supply-chain-item">Manutenzione</div>
                        <div class="supply-chain-item">Consulenza</div>
                        <div class="supply-chain-item">Formazione</div>
                    </div>
                `;
            }

            renderMissingStudies() {
                const grid = document.getElementById('missingStudiesGrid');
                
                grid.innerHTML = this.missingStudies.map(study => `
                    <div class="missing-study-card">
                        <div class="missing-study-title">${study.name}</div>
                        <div class="missing-study-markets">
                            ${study.missingMarkets.map(market => `
                                <span class="missing-market-badge">${this.getCountryFlag(market)} ${market}</span>
                            `).join('')}
                        </div>
                        <div class="missing-study-description">${study.description}</div>
                        <div class="missing-study-codes">
                            <span class="code-badge nace-badge">${study.nace}</span>
                            <span class="code-badge">${study.ateco}</span>
                        </div>
                        <div style="display: flex; justify-content: between; gap: var(--spacing-sm);">
                            <span class="text-sm" style="color: var(--${study.priority === 'alta' ? 'danger' : 'warning'});">
                                <i class="fas fa-star"></i> Priorit√† ${study.priority}
                            </span>
                            <a href="mailto:info@plimsoll.it?subject=Richiesta Studio: ${encodeURIComponent(study.name)}" class="btn btn-sm btn-primary">
                                <i class="fas fa-envelope"></i> Richiedi Studio
                            </a>
                        </div>
                    </div>
                `).join('');
            }

            async handleFileUpload(event) {
                const files = event.dataTransfer ? event.dataTransfer.files : event.target.files;
                if (!files || files.length === 0) return;

                this.showUploadProgress();
                
                for (const file of files) {
                    if (file.name.endsWith('.csv')) {
                        try {
                            await this.processCSVFile(file);
                        } catch (error) {
                            console.error('Error processing file:', file.name, error);
                            this.showToast(`Errore elaborazione ${file.name}: ${error.message}`, 'error');
                        }
                    }
                }

                this.hideUploadProgress();
                this.renderInterface();
                this.updateDashboardStats();
                this.showToast(`${files.length} file elaborati con successo`, 'success');
            }

            async processCSVFile(file) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        try {
                            const csv = e.target.result;
                            const lines = csv.split('\n').filter(line => line.trim());
                            const headers = lines[0].split(',').map(h => h.trim().replace(/"/g, ''));
                            
                            let addedCount = 0;
                            
                            for (let i = 1; i < lines.length; i++) {
                                const values = lines[i].split(',').map(v => v.trim().replace(/"/g, ''));
                                if (values.length >= headers.length) {
                                    const sector = this.parseSectorFromCSV(headers, values, file.name);
                                    if (sector && !this.sectors.find(s => s.name === sector.name && s.country === sector.country)) {
                                        this.sectors.push(sector);
                                        addedCount++;
                                    }
                                }
                            }
                            
                            console.log(`Added ${addedCount} sectors from ${file.name}`);
                            resolve(addedCount);
                        } catch (error) {
                            reject(error);
                        }
                    };
                    reader.onerror = () => reject(new Error('File reading error'));
                    reader.readAsText(file);
                });
            }

            parseSectorFromCSV(headers, values, fileName) {
                const sector = {
                    id: this.generateId(),
                    supplyChain: []
                };

                // Map CSV columns to sector properties
                headers.forEach((header, index) => {
                    const value = values[index] || '';
                    const normalizedHeader = header.toLowerCase();
                    
                    if (normalizedHeader.includes('nome') || normalizedHeader.includes('name')) {
                        sector.name = value;
                    } else if (normalizedHeader.includes('descrizione') || normalizedHeader.includes('description')) {
                        sector.description = value;
                    } else if (normalizedHeader.includes('paese') || normalizedHeader.includes('country')) {
                        sector.country = value;
                    }
                });

                // Infer missing properties
                if (!sector.name) return null;
                
                sector.nameEnglish = sector.nameEnglish || this.translateToEnglish(sector.name);
                sector.country = sector.country || this.inferCountryFromFileName(fileName);
                sector.nace = this.inferNACE(sector.name);
                sector.ateco = this.inferATECO(sector.nace, sector.name);
                sector.keywords = this.generateKeywords(sector.name);
                sector.keywordsEnglish = this.generateKeywords(sector.nameEnglish);
                
                if (!sector.description) {
                    sector.description = this.generateDescription(sector.name);
                    sector.enhanced = true;
                }
                
                if (!sector.descriptionEnglish) {
                    sector.descriptionEnglish = this.generateDescription(sector.nameEnglish);
                }

                return sector;
            }

            inferCountryFromFileName(fileName) {
                const countryMap = {
                    'REPSIT': 'IT',
                    'REPSUK': 'UK', 
                    'REPSFR': 'FR',
                    'REPSSP': 'SP',
                    'REPSPW': 'PW'
                };
                
                for (const [prefix, country] of Object.entries(countryMap)) {
                    if (fileName.startsWith(prefix)) {
                        return country;
                    }
                }
                return 'IT'; // Default
            }

            inferNACE(name) {
                const nameLower = name.toLowerCase();
                
                const naceMapping = {
                    'A': ['agricol', 'farm', 'pesca', 'allevamento'],
                    'C': ['produz', 'fabbrica', 'manifat', 'industri'],
                    'F': ['costruz', 'edil', 'immobil'],
                    'G': ['commercio', 'vendita', 'concession', 'retail'],
                    'H': ['trasport', 'logistic', 'spediz'],
                    'I': ['hotel', 'ristoran', 'albergo', 'bar'],
                    'J': ['software', 'informatica', 'IT', 'digital'],
                    'K': ['banca', 'finanz', 'assicuraz'],
                    'M': ['consulenz', 'professional', 'servizi'],
                    'S': ['servizi', 'altri']
                };

                for (const [nace, keywords] of Object.entries(naceMapping)) {
                    if (keywords.some(keyword => nameLower.includes(keyword))) {
                        return nace;
                    }
                }

                return 'S'; // Default
            }

            inferATECO(nace, name) {
                const atecoMapping = {
                    'A': '01.11.0',
                    'C': '32.99.0',
                    'F': '41.20.0',
                    'G': '47.99.0',
                    'H': '49.41.0',
                    'I': '55.10.0',
                    'J': '62.01.0',
                    'K': '64.99.0',
                    'M': '70.22.0',
                    'S': '96.09.0'
                };

                // More specific mappings based on name analysis
                const nameLower = name.toLowerCase();
                if (nameLower.includes('audi') || nameLower.includes('concession')) return '45.11.0';
                if (nameLower.includes('software') || nameLower.includes('development')) return '62.01.0';
                if (nameLower.includes('abattage') || nameLower.includes('meat')) return '10.11.0';
                if (nameLower.includes('construcci√≥n') || nameLower.includes('building')) return '41.20.0';

                return atecoMapping[nace] || '96.09.0';
            }

            generateDescription(name) {
                const templates = {
                    'automotive': 'Aziende specializzate nel settore automobilistico con servizi completi di vendita, assistenza e supporto tecnico',
                    'software': 'Societ√† di sviluppo software e soluzioni digitali per ottimizzazione dei processi aziendali',
                    'construction': 'Imprese di costruzioni specializzate in opere civili e industriali con servizi integrati',
                    'consulting': 'Societ√† di consulenza che forniscono servizi professionali specializzati alle imprese',
                    'default': `Aziende del settore ${name} che operano nel mercato fornendo prodotti e servizi specializzati`
                };

                const nameLower = name.toLowerCase();
                if (nameLower.includes('auto') || nameLower.includes('concession')) return templates.automotive;
                if (nameLower.includes('software') || nameLower.includes('IT')) return templates.software;
                if (nameLower.includes('costruz') || nameLower.includes('edil')) return templates.construction;
                if (nameLower.includes('consulenz')) return templates.consulting;

                return templates.default;
            }

            generateKeywords(name) {
                const words = name.toLowerCase()
                    .replace(/[^\w\s]/g, ' ')
                    .split(/\s+/)
                    .filter(word => word.length > 2)
                    .filter(word => !['del', 'della', 'dei', 'delle', 'and', 'the', 'of'].includes(word));
                
                return words.slice(0, 5).join(', ');
            }

            translateToEnglish(italianName) {
                const translations = {
                    'concessionarie': 'dealerships',
                    'servizi': 'services',
                    'consulenza': 'consulting',
                    'produzione': 'production',
                    'commercio': 'commerce',
                    'trasporti': 'transport',
                    'costruzioni': 'construction',
                    'software': 'software'
                };

                let englishName = italianName;
                for (const [italian, english] of Object.entries(translations)) {
                    englishName = englishName.replace(new RegExp(italian, 'gi'), english);
                }

                return englishName;
            }

            // UI Helper Methods
            getCountryFlag(countryCode) {
                const flags = {
                    'IT': 'üáÆüáπ',
                    'UK': 'üá¨üáß',
                    'FR': 'üá´üá∑',
                    'SP': 'üá™üá∏',
                    'PW': 'üåç'
                };
                return flags[countryCode] || 'üè¥';
            }

            getCountryName(countryCode) {
                const names = {
                    'IT': 'Italia',
                    'UK': 'Regno Unito', 
                    'FR': 'Francia',
                    'SP': 'Spagna',
                    'PW': 'Globale'
                };
                return names[countryCode] || countryCode;
            }

            generateId() {
                return 'sector_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            }

            // Modal and UI Methods
            openUploadModal() {
                document.getElementById('uploadModal').style.display = 'block';
            }

            closeModal(modal) {
                modal.style.display = 'none';
            }

            showUploadProgress() {
                document.getElementById('uploadProgress').classList.remove('hidden');
                document.getElementById('uploadZone').style.display = 'none';
            }

            hideUploadProgress() {
                document.getElementById('uploadProgress').classList.add('hidden');
                document.getElementById('uploadZone').style.display = 'block';
            }

            toggleSupplyChainView() {
                const section = document.getElementById('supplyChainSection');
                const isVisible = section.style.display !== 'none';
                section.style.display = isVisible ? 'none' : 'block';
                
                const btn = document.getElementById('supplyChainViewBtn');
                btn.innerHTML = isVisible ? 
                    '<i class="fas fa-project-diagram"></i> Vista Supply Chain' :
                    '<i class="fas fa-table"></i> Vista Tabella';
            }

            showSupplyChain(sectorId) {
                const sector = this.sectors.find(s => s.id === sectorId);
                if (!sector) return;

                // Show supply chain for specific sector
                this.showToast(`Supply chain per ${sector.name}`, 'info');
                this.toggleSupplyChainView();
            }

            viewStudyDetails(sectorId) {
                const sector = this.sectors.find(s => s.id === sectorId);
                if (!sector) return;

                alert(`Studio: ${sector.name}\nNACE: ${sector.nace}\nATECO: ${sector.ateco}\n\nDescrizione:\n${sector.description}`);
            }

            updateDashboardStats() {
                const total = this.sectors.length;
                const enhanced = this.sectors.filter(s => s.enhanced).length;
                const withSupplyChain = this.sectors.filter(s => s.supplyChain && s.supplyChain.length > 0).length;

                document.getElementById('totalSectors').textContent = total.toLocaleString();
                document.getElementById('heroTotalSectors').textContent = total.toLocaleString();
                document.getElementById('withDescription').textContent = (total - enhanced).toLocaleString();
                document.getElementById('enhancedDescriptions').textContent = enhanced.toLocaleString();
                document.getElementById('supplyChainMapped').textContent = withSupplyChain.toLocaleString();
            }

            updateResultsCount() {
                document.getElementById('visibleCount').textContent = this.filteredSectors.length.toLocaleString();
                document.getElementById('totalCount').textContent = this.sectors.length.toLocaleString();
            }

            exportData() {
                const dataToExport = {
                    exportDate: new Date().toISOString(),
                    totalSectors: this.sectors.length,
                    filteredSectors: this.filteredSectors.length,
                    data: this.filteredSectors
                };

                const dataStr = JSON.stringify(dataToExport, null, 2);
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `plimsoll-catalog-export-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);

                this.showToast('Export completato', 'success');
            }

            showToast(message, type = 'success') {
                const toast = document.getElementById('toast');
                const messageEl = document.getElementById('toastMessage');
                
                messageEl.textContent = message;
                toast.className = `toast ${type}`;
                toast.classList.add('show');

                setTimeout(() => {
                    toast.classList.remove('show');
                }, 3000);
            }
        }

        // Initialize the system when DOM is loaded
        let plimsollCatalog;
        document.addEventListener('DOMContentLoaded', function() {
            plimsollCatalog = new PlimsollAdvancedCatalog();
        });
    </script>
</body>
</html>
