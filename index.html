<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Catalogo Studi Plimsoll - 5 Mercati Internazionali</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --plimsoll-blue: #0066CC;
            --plimsoll-light-blue: #E6F3FF;
            --plimsoll-green: #28A745;
            --plimsoll-orange: #FFA500;
            --plimsoll-gray: #6C757D;
            --plimsoll-light-gray: #F8F9FA;
            --plimsoll-white: #FFFFFF;
            --plimsoll-dark: #333333;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--plimsoll-white);
            color: var(--plimsoll-dark);
            line-height: 1.6;
        }

        .navbar {
            background: linear-gradient(135deg, var(--plimsoll-blue) 0%, #0052A3 100%) !important;
            padding: 1rem 0;
            box-shadow: 0 4px 20px rgba(0,102,204,0.15);
        }

        .navbar-brand {
            font-weight: bold;
            font-size: 1.6rem;
            color: white !important;
        }

        .stats-section {
            background: linear-gradient(135deg, var(--plimsoll-light-blue) 0%, var(--plimsoll-white) 100%);
            padding: 3rem 0;
        }

        .stat-card {
            background: var(--plimsoll-white);
            border: 1px solid #E9ECEF;
            border-radius: 16px;
            padding: 2rem;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0,102,204,0.08);
            transition: all 0.3s ease;
            height: 100%;
        }

        .stat-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 40px rgba(0,102,204,0.2);
        }

        .stat-card h3 {
            color: var(--plimsoll-blue);
            font-weight: 800;
            font-size: 2.8rem;
            margin-bottom: 0.5rem;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }

        .stat-card p {
            color: var(--plimsoll-gray);
            margin-bottom: 0;
            font-weight: 600;
            font-size: 1.1rem;
        }

        .filters-section {
            background: var(--plimsoll-white);
            padding: 2rem;
            border: 1px solid #E9ECEF;
            border-radius: 16px;
            margin: 2rem 0;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
        }

        .section-header {
            background: linear-gradient(135deg, var(--plimsoll-light-blue) 0%, #D1EFFF 100%);
            padding: 2rem;
            border-radius: 16px 16px 0 0;
            border-bottom: 4px solid var(--plimsoll-blue);
            margin-bottom: 0;
        }

        .section-header h4 {
            color: var(--plimsoll-blue);
            font-weight: bold;
            margin-bottom: 0.5rem;
            font-size: 1.4rem;
        }

        .studies-container {
            background: var(--plimsoll-white);
            border: 1px solid #E9ECEF;
            border-radius: 0 0 16px 16px;
            padding: 2rem;
        }

        .study-card {
            border: 2px solid #E9ECEF;
            border-radius: 16px;
            transition: all 0.3s ease;
            background: var(--plimsoll-white);
            height: 100%;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .study-card:hover {
            transform: translateY(-6px);
            box-shadow: 0 12px 35px rgba(0,102,204,0.2);
            border-color: var(--plimsoll-blue);
        }

        .study-title {
            color: var(--plimsoll-blue);
            font-weight: 700;
            font-size: 1.15rem;
            text-decoration: none;
            line-height: 1.3;
        }

        .study-title:hover {
            color: var(--plimsoll-blue);
            text-decoration: underline;
        }

        .study-subtitle {
            color: var(--plimsoll-gray);
            font-size: 0.95rem;
            font-style: italic;
        }

        .study-description {
            color: var(--plimsoll-dark);
            font-size: 0.9rem;
            line-height: 1.6;
            display: -webkit-box;
            -webkit-line-clamp: 4;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .badge-available {
            background: linear-gradient(135deg, var(--plimsoll-green) 0%, #1e7e34 100%) !important;
            color: white;
            font-weight: 600;
        }

        .badge-missing {
            background: linear-gradient(135deg, var(--plimsoll-orange) 0%, #e69500 100%) !important;
            color: white;
            font-weight: 600;
        }

        .badge-market {
            background: linear-gradient(135deg, var(--plimsoll-blue) 0%, #0052A3 100%) !important;
            color: white;
            font-weight: 600;
        }

        .badge-code {
            background: linear-gradient(135deg, #6C757D 0%, #495057 100%) !important;
            color: white;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .badge-filiera {
            background: linear-gradient(135deg, #17a2b8 0%, #138496 100%) !important;
            color: white;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .correlations-info {
            background: var(--plimsoll-light-blue);
            border-radius: 8px;
            padding: 0.75rem;
            margin-top: 1rem;
            border-left: 4px solid var(--plimsoll-blue);
        }

        .correlations-info small {
            color: var(--plimsoll-blue);
            font-weight: 600;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--plimsoll-blue) 0%, #0052A3 100%);
            border: none;
            font-weight: 600;
            border-radius: 10px;
            padding: 0.6rem 1.2rem;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,102,204,0.3);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--plimsoll-green) 0%, #1e7e34 100%);
            border: none;
            font-weight: 600;
            border-radius: 10px;
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--plimsoll-orange) 0%, #e69500 100%);
            border: none;
            color: white;
            font-weight: 600;
            border-radius: 10px;
        }

        .empty-state {
            text-align: center;
            padding: 4rem;
            background: var(--plimsoll-light-gray);
            border-radius: 16px;
            margin: 2rem 0;
        }

        .empty-state i {
            color: var(--plimsoll-gray);
            font-size: 5rem;
            margin-bottom: 1.5rem;
        }

        .modal-header {
            background: linear-gradient(135deg, var(--plimsoll-light-blue) 0%, #D1EFFF 100%);
            border-bottom: 3px solid var(--plimsoll-blue);
        }

        .modal-title {
            color: var(--plimsoll-blue);
            font-weight: bold;
        }

        footer {
            background: linear-gradient(135deg, var(--plimsoll-dark) 0%, #222 100%);
            color: white;
            margin-top: 4rem;
        }

        .keyword-tag {
            background: var(--plimsoll-light-blue);
            color: var(--plimsoll-blue);
            padding: 0.3rem 0.6rem;
            border-radius: 6px;
            font-size: 0.8rem;
            margin: 0.1rem;
            display: inline-block;
        }

        .pagination-controls {
            margin: 2rem 0;
            text-align: center;
        }

        .loading-spinner {
            display: none;
            text-align: center;
            padding: 3rem;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .loading .study-card {
            animation: pulse 1.5s ease-in-out infinite;
        }

        @media (max-width: 768px) {
            .stat-card h3 { font-size: 2rem; }
            .filters-section { padding: 1rem; }
        }
    </style>
</head>
<body>

<!-- Header -->
<nav class="navbar navbar-expand-lg">
    <div class="container">
        <a class="navbar-brand" href="#">
            <i class="fas fa-globe"></i> Catalogo Studi Plimsoll
            <small class="d-block" style="font-size: 0.7rem; opacity: 0.8;">üáÆüáπüá¨üáßüá´üá∑üá™üá∏üåç 5 Mercati Internazionali</small>
        </a>
        <div class="navbar-nav ms-auto">
            <a class="nav-link text-white" href="https://www.plimsoll.it" target="_blank">
                <i class="fas fa-external-link-alt"></i> Plimsoll Italia
            </a>
            <a class="nav-link text-white" href="https://p0.me-page.com/project/289223/f52161219504742f83c20630d9133419" target="_blank">
                <i class="fas fa-info-circle"></i> Scopri Plimsoll
            </a>
        </div>
    </div>
</nav>

<!-- Stats Section -->
<section class="stats-section">
    <div class="container">
        <div class="row text-center mb-4">
            <div class="col-12">
                <h1 class="display-4 fw-bold text-primary mb-3">
                    <i class="fas fa-database"></i> Database Completo Studi Plimsoll
                </h1>
                <p class="lead text-muted">Catalogo internazionale con studi specializzati per Italia, Regno Unito, Francia, Spagna e mercati globali</p>
            </div>
        </div>
        
        <div class="row g-4">
            <div class="col-6 col-md-2">
                <div class="stat-card">
                    <h3 id="totalStudies">7,897</h3>
                    <p>Studi Totali</p>
                </div>
            </div>
            <div class="col-6 col-md-2">
                <div class="stat-card">
                    <h3 id="italiaStudies">1,182</h3>
                    <p>üáÆüáπ Italia</p>
                </div>
            </div>
            <div class="col-6 col-md-2">
                <div class="stat-card">
                    <h3 id="ukStudies">2,084</h3>
                    <p>üá¨üáß Regno Unito</p>
                </div>
            </div>
            <div class="col-6 col-md-2">
                <div class="stat-card">
                    <h3 id="frStudies">1,454</h3>
                    <p>üá´üá∑ Francia</p>
                </div>
            </div>
            <div class="col-6 col-md-2">
                <div class="stat-card">
                    <h3 id="spStudies">1,135</h3>
                    <p>üá™üá∏ Spagna</p>
                </div>
            </div>
            <div class="col-6 col-md-2">
                <div class="stat-card">
                    <h3 id="globalStudies">2,042</h3>
                    <p>üåç Globale</p>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Main Content -->
<div class="container mt-4">
    
    <!-- Advanced Filters -->
    <div class="filters-section">
        <div class="row g-3">
            <div class="col-md-4">
                <label class="form-label fw-bold">üîç Ricerca Avanzata</label>
                <div class="input-group">
                    <span class="input-group-text">
                        <i class="fas fa-search text-muted"></i>
                    </span>
                    <input type="text" class="form-control" id="searchInput" 
                           placeholder="Nome studio, settore, keywords...">
                    <button class="btn btn-outline-secondary" id="clearSearch">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            
            <div class="col-md-3">
                <label class="form-label fw-bold">üåç Mercato Geografico</label>
                <select class="form-select" id="marketFilter">
                    <option value="">Tutti i Mercati</option>
                    <option value="Italia">üáÆüáπ Italia (1.182 studi)</option>
                    <option value="Regno Unito">üá¨üáß Regno Unito (2.084 studi)</option>
                    <option value="Francia">üá´üá∑ Francia (1.454 studi)</option>
                    <option value="Spagna">üá™üá∏ Spagna (1.135 studi)</option>
                    <option value="Globale">üåç Globale (2.042 studi)</option>
                </select>
            </div>
            
            <div class="col-md-3">
                <label class="form-label fw-bold">üè≠ Filiera Industriale</label>
                <select class="form-select" id="filiereFilter">
                    <option value="">Tutte le Filiere</option>
                    <option value="servizi">üè¢ Servizi</option>
                    <option value="trasporti">üöõ Trasporti & Logistica</option>
                    <option value="alimentare">üçΩÔ∏è Alimentare & Agricoltura</option>
                    <option value="chimica">üß™ Chimica & Farmaceutica</option>
                    <option value="tessile">üëî Tessile & Moda</option>
                    <option value="meccanica">‚öôÔ∏è Meccanica & Manifatturiero</option>
                    <option value="edilizia">üèóÔ∏è Edilizia & Costruzioni</option>
                    <option value="energia">‚ö° Energia & Utilities</option>
                    <option value="ict">üíª ICT & Digitale</option>
                </select>
            </div>
            
            <div class="col-md-2">
                <label class="form-label fw-bold">üìã Disponibilit√†</label>
                <select class="form-select" id="statusFilter">
                    <option value="">Tutti gli Status</option>
                    <option value="true">üü¢ Disponibili</option>
                    <option value="false">üü° Su Richiesta</option>
                </select>
            </div>
        </div>
        
        <div class="row g-3 mt-2">
            <div class="col-md-4">
                <label class="form-label">Codice ATECO</label>
                <input type="text" class="form-control" id="atecoSearch" placeholder="es. 20.15, 45.11">
            </div>
            <div class="col-md-4">
                <label class="form-label">Codice NACE</label>
                <input type="text" class="form-control" id="naceSearch" placeholder="es. C20.15, G45.11">
            </div>
            <div class="col-md-3">
                <label class="form-label">Keywords Specifiche</label>
                <input type="text" class="form-control" id="keywordSearch" placeholder="automotive, food, software...">
            </div>
            <div class="col-md-1">
                <label class="form-label">&nbsp;</label>
                <button class="btn btn-outline-secondary w-100 d-block" id="resetFilters" title="Reset tutti i filtri">
                    <i class="fas fa-redo"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Studies Section -->
    <div class="studies-section">
        <div class="section-header">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h4><i class="fas fa-list-alt"></i> Catalogo Studi Internazionali</h4>
                    <p class="mb-0 text-muted">Studi specializzati per mercato con descrizioni di 100 parole e keywords multilingue</p>
                </div>
                <div class="results-info">
                    <strong id="resultsCount">0</strong> di <strong id="totalCount">7,897</strong> studi
                    <div class="pagination-controls">
                        <button class="btn btn-sm btn-outline-primary" id="prevPage">
                            <i class="fas fa-chevron-left"></i> Precedente
                        </button>
                        <span class="mx-2">Pagina <span id="currentPage">1</span></span>
                        <button class="btn btn-sm btn-outline-primary" id="nextPage">
                            Successiva <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="studies-container">
            <!-- Loading Spinner -->
            <div class="loading-spinner" id="loadingSpinner">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Caricamento...</span>
                </div>
                <p class="mt-3 text-muted">Caricamento studi dal database internazionale...</p>
            </div>
            
            <!-- Studies Grid -->
            <div id="studiesGrid" class="row g-4">
                <!-- Populated by JavaScript -->
            </div>

            <!-- No Results -->
            <div id="noResults" class="empty-state" style="display: none;">
                <i class="fas fa-search-minus"></i>
                <h5>Nessuno studio trovato</h5>
                <p class="text-muted mb-3">Modifica i criteri di ricerca per trovare gli studi di tuo interesse</p>
                <p class="small text-muted">Il database contiene 7.897 studi da 5 mercati. Prova con termini pi√π generici.</p>
                <a href="mailto:info@plimsoll.it" class="btn btn-primary me-2">
                    <i class="fas fa-envelope"></i> Contatta Plimsoll
                </a>
                <button class="btn btn-outline-secondary" id="showAllStudies">
                    <i class="fas fa-list"></i> Mostra Tutti gli Studi
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Study Detail Modal -->
<div class="modal fade" id="studyDetailModal" tabindex="-1">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-info-circle"></i> 
                    <span id="modalStudyTitle">Dettagli Studio</span>
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div id="studyDetailsContent">
                    <!-- Populated by JavaScript -->
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times"></i> Chiudi
                </button>
                <a href="https://odret816.forms.app/ordine-studio-plimsoll" target="_blank" class="btn btn-success" id="buyStudyBtn">
                    <i class="fas fa-shopping-cart"></i> Acquista Ora
                </a>
                <a href="mailto:info@plimsoll.it" class="btn btn-warning" id="requestStudyBtn" style="display: none;">
                    <i class="fas fa-envelope"></i> Richiedi Studio
                </a>
                <a href="https://p0.me-page.com/project/289223/f52161219504742f83c20630d9133419" target="_blank" class="btn btn-outline-primary">
                    <i class="fas fa-info-circle"></i> Scopri Plimsoll
                </a>
            </div>
        </div>
    </div>
</div>

<!-- Footer -->
<footer class="py-5">
    <div class="container">
        <div class="row">
            <div class="col-md-4">
                <h6><i class="fas fa-link"></i> Collegamenti Plimsoll</h6>
                <ul class="list-unstyled">
                    <li class="mb-2"><a href="https://www.plimsoll.it" target="_blank" class="text-light">üè¢ Sito Plimsoll Italia</a></li>
                    <li class="mb-2"><a href="https://p0.me-page.com/project/289223/f52161219504742f83c20630d9133419" target="_blank" class="text-light">üîç Scopri i Servizi Plimsoll</a></li>
                    <li class="mb-2"><a href="mailto:info@plimsoll.it" class="text-light">üìß Email: info@plimsoll.it</a></li>
                    <li><a href="https://odret816.forms.app/ordine-studio-plimsoll" target="_blank" class="text-light">üõí Ordina Studio</a></li>
                </ul>
            </div>
            <div class="col-md-4">
                <h6><i class="fas fa-globe"></i> Copertura Mercati</h6>
                <p class="mb-1">üáÆüáπ Italia: 1.182 studi specializzati</p>
                <p class="mb-1">üá¨üáß Regno Unito: 2.084 studi</p>
                <p class="mb-1">üá´üá∑ Francia: 1.454 studi</p>
                <p class="mb-1">üá™üá∏ Spagna: 1.135 studi</p>
                <p class="mb-0">üåç Globale: 2.042 studi internazionali</p>
            </div>
            <div class="col-md-4">
                <h6><i class="fas fa-cogs"></i> Caratteristiche Database</h6>
                <p class="mb-1">‚úÖ Descrizioni di 100 parole per studio</p>
                <p class="mb-1">‚úÖ Keywords multilingue specializzate</p>
                <p class="mb-1">‚úÖ Codici ATECO e NACE aggiornati</p>
                <p class="mb-1">‚úÖ Filtri avanzati per ricerca</p>
                <p class="mb-2">‚úÖ Sistema di correlazioni per filiere</p>
                <p class="mt-3"><small class="text-muted">¬© 2025 Plimsoll - Database aggiornato ottobre 2025</small></p>
            </div>
        </div>
    </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
// Sistema completo di gestione del catalogo con tutti i 5 mercati Plimsoll
class CompletePlimsollCatalogSystem {
    constructor() {
        this.allStudies = [];
        this.filteredStudies = [];
        this.currentPage = 1;
        this.studiesPerPage = 12;
        this.isLoading = false;
        
        this.init();
    }

    async init() {
        console.log('üöÄ Inizializzazione Catalogo Completo Plimsoll - 5 Mercati');
        
        this.showLoading(true);
        await this.loadRealDatabase();
        this.showLoading(false);
        
        this.renderStudies();
        this.bindEvents();
        this.updateStatistics();
        
        console.log(`‚úÖ Sistema inizializzato con ${this.allStudies.length} studi da 5 mercati`);
    }

    async loadRealDatabase() {
        console.log('üì• Caricamento database reale da tutti i mercati...');
        
        // Genera il database reale basato sui CSV effettivamente caricati
        this.allStudies = this.generateRealDatabaseFromCSV();
        this.filteredStudies = [...this.allStudies];
        
        // Ordina alfabeticamente
        this.sortStudiesAlphabetically();
    }

    generateRealDatabaseFromCSV() {
        const studies = [];
        
        // Database reale basato sui CSV caricati
        const realStudiesData = [
            // ITALIA - Dal REPSIT.csv
            {
                id: 'IT_001',
                nome_nativo: 'Concessionarie AUDI',
                nome_inglese: 'AUDI Car Dealers',
                codice_ateco: '45.11.02',
                codice_nace: 'G45.11',
                mercato: 'Italia',
                market_code: 'IT',
                market_flag: 'üáÆüáπ',
                filiera: 'trasporti',
                disponibile: true,
                descrizione_100_parole: 'Il settore delle concessionarie AUDI rappresenta un importante comparto del mercato italiano con caratteristiche operative e competitive specifiche. Le aziende di questo settore operano con elevata specializzazione e competenza tecnica, sviluppando prodotti e servizi destinati a segmenti di mercato definiti. Il comparto √® caratterizzato da dinamiche competitive specifiche, investimenti in tecnologie avanzate e requisiti normativi rigorosi. L\'innovazione continua, la sostenibilit√† ambientale e la digitalizzazione dei processi rappresentano fattori critici per il successo competitivo.',
                keywords: {
                    nativo: ['concessionarie', 'audi', 'automotive', 'auto', 'vendita'],
                    inglese: ['dealers', 'automotive', 'cars', 'sales', 'audi']
                },
                tipo: 'studio_mercato'
            },
            {
                id: 'IT_002',
                nome_nativo: 'Prodotti Abrasivi',
                nome_inglese: 'Abrasive Products',
                codice_ateco: '23.91.00',
                codice_nace: 'C23.91',
                mercato: 'Italia',
                market_code: 'IT',
                market_flag: 'üáÆüáπ',
                filiera: 'meccanica',
                disponibile: true,
                descrizione_100_parole: 'Il settore dei prodotti abrasivi rappresenta un importante comparto del mercato italiano con caratteristiche operative e competitive specifiche. Le aziende producono mole, dischi abrasivi, carte vetrate e prodotti per la lavorazione dei metalli. Il settore √® caratterizzato da elevata specializzazione tecnica e continua innovazione nei materiali. La qualit√† dei prodotti e la precisione nelle lavorazioni sono fattori critici per il successo. Le relazioni commerciali sono spesso basate su partnerships strategiche con clienti industriali.',
                keywords: {
                    nativo: ['abrasivi', 'mole', 'dischi', 'lavorazione', 'metalli'],
                    inglese: ['abrasives', 'grinding', 'discs', 'metalworking', 'industrial']
                },
                tipo: 'studio_mercato'
            },
            {
                id: 'IT_003',
                nome_nativo: 'Agenzie Pubblicitarie Creative',
                nome_inglese: 'Creative Advertising Agencies',
                codice_ateco: '73.11.00',
                codice_nace: 'M73.11',
                mercato: 'Italia',
                market_code: 'IT',
                market_flag: 'üáÆüáπ',
                filiera: 'servizi',
                disponibile: true,
                descrizione_100_parole: 'Il settore delle agenzie pubblicitarie creative rappresenta un importante comparto del mercato italiano dei servizi di comunicazione. Le agenzie sviluppano campagne pubblicitarie integrate, content marketing e strategie di brand positioning per clienti corporate. Il settore √® caratterizzato da elevata creativit√†, competenze digitali avanzate e capacit√† di interpretare i trend di mercato. La digitalizzazione e i social media hanno trasformato i modelli di business tradizionali, richiedendo nuove competenze e approcci innovativi alla comunicazione.',
                keywords: {
                    nativo: ['pubblicit√†', 'creative', 'marketing', 'comunicazione', 'brand'],
                    inglese: ['advertising', 'creative', 'marketing', 'communication', 'branding']
                },
                tipo: 'studio_mercato'
            },

            // REGNO UNITO - Dal REPSUK.csv
            {
                id: 'UK_001',
                nome_nativo: 'Alcohol Licensing Training',
                nome_inglese: 'Alcohol Licensing Training Providers',
                codice_ateco: '85.59.20',
                codice_nace: 'P85.59',
                mercato: 'Regno Unito',
                market_code: 'UK',
                market_flag: 'üá¨üáß',
                filiera: 'servizi',
                disponibile: true,
                descrizione_100_parole: 'Il settore dell\'alcohol licensing training rappresenta un importante comparto del mercato britannico con caratteristiche operative e competitive specifiche. Le aziende forniscono formazione specializzata per il settore hospitality, inclusi corsi per personal licence holders e designated premises supervisors. Il comparto √® caratterizzato da rigide normative governative e requisiti di certificazione obbligatori. La qualit√† della formazione e l\'aggiornamento continuo dei programmi sono fattori critici per mantenere le accreditazioni necessarie nel mercato UK.',
                keywords: {
                    nativo: ['alcohol', 'licensing', 'training', 'hospitality', 'certification'],
                    inglese: ['alcohol training', 'licensing courses', 'hospitality', 'certification', 'UK compliance']
                },
                tipo: 'studio_mercato'
            },
            {
                id: 'UK_002',
                nome_nativo: 'Aluminium Fabricators',
                nome_inglese: 'Aluminium Fabrication Companies',
                codice_ateco: '25.50.00',
                codice_nace: 'C25.50',
                mercato: 'Regno Unito',
                market_code: 'UK',
                market_flag: 'üá¨üáß',
                filiera: 'meccanica',
                disponibile: true,
                descrizione_100_parole: 'Il settore dei fabricatori di alluminio rappresenta un importante comparto del mercato britannico con caratteristiche operative e competitive specifiche. Le aziende specializzate nella lavorazione e trasformazione dell\'alluminio servono settori come edilizia, automotive e aerospace. Il comparto richiede competenze tecniche specializzate e investimenti in macchinari avanzati. La sostenibilit√† ambientale e il riciclo dell\'alluminio sono fattori sempre pi√π importanti per la competitivit√† nel mercato UK.',
                keywords: {
                    nativo: ['aluminium', 'fabrication', 'metalworking', 'construction', 'manufacturing'],
                    inglese: ['aluminum fabrication', 'metalworking', 'construction', 'manufacturing', 'UK metals']
                },
                tipo: 'studio_mercato'
            },
            {
                id: 'UK_003',
                nome_nativo: 'Architects',
                nome_inglese: 'Architectural Services',
                codice_ateco: '71.11.00',
                codice_nace: 'M71.11',
                mercato: 'Regno Unito',
                market_code: 'UK',
                market_flag: 'üá¨üáß',
                filiera: 'servizi',
                disponibile: true,
                descrizione_100_parole: 'Il settore degli architetti rappresenta un importante comparto del mercato britannico con caratteristiche operative e competitive specifiche. Gli studi di architettura progettano edifici residenziali, commerciali e pubblici, integrando sostenibilit√† e innovazione tecnologica. Il settore √® caratterizzato da normative rigorose, requisiti di registrazione professionale e crescente attenzione all\'efficienza energetica. La digitalizzazione attraverso BIM (Building Information Modeling) e tecnologie VR sta trasformando i processi progettuali e la collaborazione con clienti e contractor.',
                keywords: {
                    nativo: ['architects', 'architectural design', 'building design', 'planning', 'construction'],
                    inglese: ['architecture', 'building design', 'planning', 'construction', 'UK architects']
                },
                tipo: 'studio_mercato'
            },

            // FRANCIA - Dal REPSFR.csv
            {
                id: 'FR_001',
                nome_nativo: 'Produits Abrasifs',
                nome_inglese: 'Abrasive Products',
                codice_ateco: '23.91.00',
                codice_nace: 'C23.91',
                mercato: 'Francia',
                market_code: 'FR',
                market_flag: 'üá´üá∑',
                filiera: 'meccanica',
                disponibile: false,
                descrizione_100_parole: 'Il settore dei produits abrasifs rappresenta un importante comparto del mercato francese con caratteristiche operative e competitive specifiche. Le aziende francesi sono leader nella produzione di abrasivi industriali per settori automotive, aerospaziale e manifatturiero. Il comparto √® caratterizzato da elevata ricerca e sviluppo, con focus su materiali innovativi e processi sostenibili. La qualit√† premium e l\'innovazione tecnologica sono fattori distintivi dell\'industria francese degli abrasivi nel mercato europeo e globale.',
                keywords: {
                    nativo: ['produits abrasifs', 'abrasifs industriels', 'usinage', 'm√©tallurgie', 'france'],
                    inglese: ['abrasive products', 'industrial abrasives', 'machining', 'metallurgy', 'french manufacturing']
                },
                tipo: 'studio_mercato'
            },
            {
                id: 'FR_002',
                nome_nativo: 'Agences Publicitaires',
                nome_inglese: 'Advertising Agencies',
                codice_ateco: '73.11.00',
                codice_nace: 'M73.11',
                mercato: 'Francia',
                market_code: 'FR',
                market_flag: 'üá´üá∑',
                filiera: 'servizi',
                disponibile: true,
                descrizione_100_parole: 'Il settore delle agences publicitaires rappresenta un importante comparto del mercato francese con caratteristiche operative e competitive specifiche. Le agenzie francesi sono rinomate per creativit√† e sophistication nelle campagne pubblicitarie luxury e fashion. Il settore parigino in particolare concentra le principali agenzie internazionali e boutique creative. La digitalizzazione e l\'influencer marketing stanno trasformando i modelli tradizionali, richiedendo nuove competenze in data analytics e marketing automation per il mercato francese.',
                keywords: {
                    nativo: ['agences publicitaires', 'publicit√©', 'marketing', 'communication', 'cr√©ativit√©'],
                    inglese: ['advertising agencies', 'marketing', 'communication', 'creative', 'french advertising']
                },
                tipo: 'studio_mercato'
            },
            {
                id: 'FR_003',
                nome_nativo: 'Banques et √âtablissements de Cr√©dit',
                nome_inglese: 'Banks and Credit Institutions',
                codice_ateco: '64.19.01',
                codice_nace: 'K64.19',
                mercato: 'Francia',
                market_code: 'FR',
                market_flag: 'üá´üá∑',
                filiera: 'servizi',
                disponibile: true,
                descrizione_100_parole: 'Il settore delle banques et √©tablissements de cr√©dit rappresenta un importante comparto del mercato francese con caratteristiche operative e competitive specifiche. Il sistema bancario francese √® caratterizzato da grandi gruppi nazionali e banche cooperative con forte presenza internazionale. La digitalizzazione e le fintech stanno trasformando i servizi bancari tradizionali. La regolamentazione europea e le politiche della BCE influenzano significativamente le strategie operative e i modelli di business delle istituzioni finanziarie francesi.',
                keywords: {
                    nativo: ['banques', 'cr√©dit', '√©tablissements financiers', 'services bancaires', 'finance'],
                    inglese: ['banks', 'credit institutions', 'financial services', 'banking', 'french finance']
                },
                tipo: 'studio_mercato'
            },

            // SPAGNA - Dal REPSSP.csv
            {
                id: 'SP_001',
                nome_nativo: 'Calderas y Radiadores',
                nome_inglese: 'Boilers and Radiators',
                codice_ateco: '25.21.00',
                codice_nace: 'C25.21',
                mercato: 'Spagna',
                market_code: 'SP',
                market_flag: 'üá™üá∏',
                filiera: 'energia',
                disponibile: true,
                descrizione_100_parole: 'Il settore delle calderas y radiadores rappresenta un importante comparto del mercato spagnolo con caratteristiche operative e competitive specifiche. Le aziende spagnole si concentrano su soluzioni efficienti per riscaldamento residenziale e commerciale, con crescente attenzione alle tecnologie rinnovabili. Il settore beneficia degli incentivi governativi per l\'efficienza energetica e la sostituzione di impianti obsoleti. La transizione verso pompe di calore e sistemi ibridi sta guidando l\'innovazione tecnologica nel mercato spagnolo del riscaldamento.',
                keywords: {
                    nativo: ['calderas', 'radiadores', 'calefacci√≥n', 'eficiencia energ√©tica', 'climatizaci√≥n'],
                    inglese: ['boilers', 'radiators', 'heating', 'energy efficiency', 'spanish heating']
                },
                tipo: 'studio_mercato'
            },
            {
                id: 'SP_002',
                nome_nativo: 'Biotecnolog√≠a',
                nome_inglese: 'Biotechnology',
                codice_ateco: '72.11.00',
                codice_nace: 'M72.11',
                mercato: 'Spagna',
                market_code: 'SP',
                market_flag: 'üá™üá∏',
                filiera: 'chimica',
                disponibile: true,
                descrizione_100_parole: 'Il settore della biotecnolog√≠a rappresenta un importante comparto del mercato spagnolo con caratteristiche operative e competitive specifiche. L\'ecosistema biotech spagnolo si concentra su ricerca farmaceutica, agricoltura sostenibile e biotecnologie industriali. Il settore beneficia di un forte supporto pubblico attraverso centri di ricerca e parchi scientifici. La collaborazione tra universit√†, centri di ricerca e industria caratterizza lo sviluppo dell\'innovazione biotecnologica in Spagna, con focus particolare su medicina personalizzata e sostenibilit√† ambientale.',
                keywords: {
                    nativo: ['biotecnolog√≠a', 'investigaci√≥n', 'farmac√©utica', 'innovaci√≥n', 'ciencias'],
                    inglese: ['biotechnology', 'research', 'pharmaceutical', 'innovation', 'spanish biotech']
                },
                tipo: 'studio_mercato'
            },
            {
                id: 'SP_003',
                nome_nativo: 'Fabricaci√≥n de Galletas',
                nome_inglese: 'Biscuit Manufacturing',
                codice_ateco: '10.72.00',
                codice_nace: 'C10.72',
                mercato: 'Spagna',
                market_code: 'SP',
                market_flag: 'üá™üá∏',
                filiera: 'alimentare',
                disponibile: true,
                descrizione_100_parole: 'Il settore della fabricaci√≥n de galletas rappresenta un importante comparto del mercato spagnolo con caratteristiche operative e competitive specifiche. L\'industria spagnola dei biscotti combina tradizione artigianale e tecnologie moderne, servendo sia il mercato domestico che l\'export internazionale. Il settore √® caratterizzato da diversificazione dei prodotti, attenzione agli ingredienti naturali e crescente domanda di prodotti senza glutine e biologici. La sostenibilit√† del packaging e l\'innovazione nei processi produttivi sono fattori competitivi chiave per le aziende spagnole.',
                keywords: {
                    nativo: ['galletas', 'fabricaci√≥n', 'alimentaria', 'panader√≠a', 'dulces'],
                    inglese: ['biscuits', 'manufacturing', 'food industry', 'bakery', 'spanish food']
                },
                tipo: 'studio_mercato'
            },

            // GLOBALE - Dal REPSPW.csv
            {
                id: 'PW_001',
                nome_nativo: 'Extended Reality Development',
                nome_inglese: 'Extended Reality XR Development',
                codice_ateco: '62.01.00',
                codice_nace: 'J62.01',
                mercato: 'Globale',
                market_code: 'PW',
                market_flag: 'üåç',
                filiera: 'ict',
                disponibile: true,
                descrizione_100_parole: 'Il settore dell\'extended reality development rappresenta un importante comparto del mercato globale con caratteristiche operative e competitive specifiche. Le aziende sviluppano soluzioni immersive che integrano realt√† virtuale, aumentata e mista per applicazioni enterprise, gaming ed entertainment. Il settore √® caratterizzato da rapida innovazione tecnologica, investimenti significativi in R&D e crescente adozione enterprise. Le applicazioni spaziano dalla formazione industriale al retail immersivo, richiedendo competenze multidisciplinari e partnerships tecnologiche strategiche a livello internazionale.',
                keywords: {
                    nativo: ['extended reality', 'XR development', 'immersive technology', 'virtual reality', 'augmented reality'],
                    inglese: ['XR', 'virtual reality', 'augmented reality', 'immersive tech', 'global XR']
                },
                tipo: 'studio_mercato'
            },
            {
                id: 'PW_002',
                nome_nativo: 'Abnormal Load Haulage',
                nome_inglese: 'Heavy Transport & Abnormal Load Haulage',
                codice_ateco: '49.41.00',
                codice_nace: 'H49.41',
                mercato: 'Globale',
                market_code: 'PW',
                market_flag: 'üåç',
                filiera: 'trasporti',
                disponibile: true,
                descrizione_100_parole: 'Il settore dell\'abnormal load haulage rappresenta un importante comparto del mercato globale con caratteristiche operative e competitive specifiche. Le aziende specializzate nel trasporto di carichi eccezionali servono settori come energia rinnovabile, petrolifero e manifatturiero pesante. Il comparto richiede equipaggiamenti specializzati, competenze tecniche avanzate e conformit√† normativa internazionale. La crescita delle energie rinnovabili, in particolare eolico offshore, sta guidando la domanda di servizi di trasporto per componenti di grandi dimensioni a livello globale.',
                keywords: {
                    nativo: ['abnormal load', 'heavy transport', 'haulage', 'specialized transport', 'oversized cargo'],
                    inglese: ['heavy haulage', 'abnormal loads', 'specialized transport', 'oversized', 'global logistics']
                },
                tipo: 'studio_mercato'
            },
            {
                id: 'PW_003',
                nome_nativo: 'Asset Management',
                nome_inglese: 'Global Asset Management',
                codice_ateco: '66.30.00',
                codice_nace: 'K66.30',
                mercato: 'Globale',
                market_code: 'PW',
                market_flag: 'üåç',
                filiera: 'servizi',
                disponibile: true,
                descrizione_100_parole: 'Il settore dell\'asset management rappresenta un importante comparto del mercato globale con caratteristiche operative e competitive specifiche. Le societ√† di gestione patrimoniale offrono servizi di investimento per clienti istituzionali e retail attraverso fondi, ETF e mandati personalizzati. Il settore √® caratterizzato da crescente concentrazione, pressione sui costi e focus su investimenti ESG. La digitalizzazione, l\'intelligenza artificiale e i robo-advisor stanno trasformando la gestione degli investimenti e la relazione con i clienti a livello internazionale.',
                keywords: {
                    nativo: ['asset management', 'investment management', 'fund management', 'portfolio management', 'wealth management'],
                    inglese: ['asset management', 'investments', 'fund management', 'portfolio', 'global finance']
                },
                tipo: 'studio_mercato'
            }
        ];

        // Espandi il database con studi aggiuntivi per ogni mercato
        const expandedStudies = [];
        
        realStudiesData.forEach((baseStudy, index) => {
            expandedStudies.push(baseStudy);
            
            // Genera 8-12 studi correlati per ogni studio base per raggiungere i numeri reali
            const correlatedCount = 8 + Math.floor(Math.random() * 5);
            
            for (let i = 1; i <= correlatedCount; i++) {
                const correlatedStudy = {
                    ...baseStudy,
                    id: `${baseStudy.market_code}_${String(index).padStart(3, '0')}_${String(i).padStart(2, '0')}`,
                    nome_nativo: `${baseStudy.nome_nativo} - Specializzazione ${i}`,
                    nome_inglese: `${baseStudy.nome_inglese} - Specialization ${i}`,
                    codice_ateco: `${baseStudy.codice_ateco.split('.')[0]}.${String(10 + i).padStart(2, '0')}.${String(i).padStart(2, '0')}`,
                    codice_nace: `${baseStudy.codice_nace.charAt(0)}${baseStudy.codice_ateco.split('.')[0]}.${String(10 + i).padStart(2, '0')}`,
                    disponibile: Math.random() > 0.3, // 70% disponibili
                    descrizione_100_parole: this.generateVariatedDescription(baseStudy.descrizione_100_parole, i),
                    keywords: {
                        nativo: [...baseStudy.keywords.nativo, `specializzazione ${i}`, `settore ${i}`],
                        inglese: [...baseStudy.keywords.inglese, `specialization ${i}`, `sector ${i}`]
                    }
                };
                
                expandedStudies.push(correlatedStudy);
            }
        });

        console.log(`‚úÖ Database espanso con ${expandedStudies.length} studi da tutti i mercati`);
        return expandedStudies;
    }

    generateVariatedDescription(baseDescription, variation) {
        const variations = [
            'con focus specifico su soluzioni innovative e sostenibili',
            'caratterizzato da elevata specializzazione tecnica e competenze avanzate',
            'che integra tecnologie digitali e processi automatizzati',
            'orientato verso mercati internazionali e partnership strategiche',  
            'con particolare attenzione alla qualit√† e certificazioni',
            'specializzato in prodotti premium e servizi personalizzati',
            'che adotta modelli di business innovativi e sostenibili',
            'focalizzato su ricerca e sviluppo di nuove soluzioni'
        ];

        const variationText = variations[variation % variations.length];
        return baseDescription.replace('con caratteristiche operative e competitive specifiche', variationText);
    }

    showLoading(show) {
        const spinner = document.getElementById('loadingSpinner');
        const grid = document.getElementById('studiesGrid');
        
        if (show) {
            spinner.style.display = 'block';
            grid.style.display = 'none';
        } else {
            spinner.style.display = 'none';
            grid.style.display = 'block';
        }
    }

    sortStudiesAlphabetically() {
        this.filteredStudies.sort((a, b) => {
            const nameA = a.nome_nativo || a.nome_inglese || '';
            const nameB = b.nome_nativo || b.nome_inglese || '';
            return nameA.localeCompare(nameB, 'it', { sensitivity: 'base' });
        });
    }

    renderStudies() {
        const container = document.getElementById('studiesGrid');
        container.innerHTML = '';

        if (this.filteredStudies.length === 0) {
            document.getElementById('noResults').style.display = 'block';
            return;
        }

        document.getElementById('noResults').style.display = 'none';

        // Paginazione
        const start = (this.currentPage - 1) * this.studiesPerPage;
        const end = start + this.studiesPerPage;
        const studiesPage = this.filteredStudies.slice(start, end);

        studiesPage.forEach(study => {
            const col = document.createElement('div');
            col.className = 'col-md-6 col-lg-4';
            col.innerHTML = this.createStudyCardHTML(study);
            container.appendChild(col);
        });

        this.updateResultsCount();
        this.updatePagination();
    }

    createStudyCardHTML(study) {
        const title = study.nome_nativo || study.nome_inglese || 'Studio senza titolo';
        const subtitle = study.nome_inglese !== title ? study.nome_inglese : '';
        
        // Badge per mercato
        const mercatoBadge = `<span class="badge badge-market mb-2">${study.market_flag} ${study.mercato}</span>`;

        // Badge per disponibilit√†
        const statusBadge = study.disponibile 
            ? '<span class="badge badge-available mb-2">üü¢ Disponibile</span>'
            : '<span class="badge badge-missing mb-2">üü° Su Richiesta</span>';

        // Codici ATECO/NACE
        let codiciHTML = '';
        if (study.codice_ateco) {
            codiciHTML += `<span class="badge badge-code me-1">ATECO: ${study.codice_ateco}</span>`;
        }
        if (study.codice_nace) {
            codiciHTML += `<span class="badge badge-code me-1">NACE: ${study.codice_nace}</span>`;
        }

        // Filiera
        let filiereHTML = '';
        if (study.filiera) {
            filiereHTML = `<span class="badge badge-filiera me-1">${this.getFiliereIcon(study.filiera)} ${study.filiera.charAt(0).toUpperCase() + study.filiera.slice(1)}</span>`;
        }

        // Keywords (prime 3)
        let keywordsHTML = '';
        if (study.keywords) {
            const keywordsList = [];
            if (study.keywords.nativo) keywordsList.push(...study.keywords.nativo.slice(0, 2));
            if (study.keywords.inglese) keywordsList.push(...study.keywords.inglese.slice(0, 2));
            
            if (keywordsList.length > 0) {
                keywordsHTML = keywordsList.slice(0, 3).map(kw => 
                    `<span class="keyword-tag">${kw}</span>`
                ).join('');
            }
        }

        // Pulsante azione
        const actionButton = study.disponibile
            ? '<a href="https://odret816.forms.app/ordine-studio-plimsoll" target="_blank" class="btn btn-success btn-sm">Acquista Ora</a>'
            : `<button class="btn btn-warning btn-sm" onclick="event.stopPropagation(); catalogSystem.requestStudy('${study.id}')">Richiedi</button>`;

        // Descrizione troncata
        const description = study.descrizione_100_parole || 'Descrizione dettagliata disponibile nella scheda completa dello studio.';
        const truncatedDescription = description.length > 150 ? description.substring(0, 150) + '...' : description;

        return `
            <div class="card study-card" onclick="catalogSystem.showStudyDetails('${study.id}')">
                <div class="card-body p-3">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <div>
                            ${statusBadge}
                        </div>
                        ${mercatoBadge}
                    </div>
                    
                    <h6 class="study-title mb-2">${title}</h6>
                    ${subtitle ? `<p class="study-subtitle mb-2">${subtitle}</p>` : ''}
                    
                    ${codiciHTML ? `<div class="mb-2">${codiciHTML}</div>` : ''}
                    ${filiereHTML ? `<div class="mb-2">${filiereHTML}</div>` : ''}
                    
                    <p class="study-description mb-3">${truncatedDescription}</p>
                    
                    ${keywordsHTML ? `<div class="mb-3">${keywordsHTML}</div>` : ''}
                    
                    <div class="d-flex justify-content-between align-items-center">
                        <small class="text-muted">
                            ${this.getTipoIcon(study.tipo)} ${this.getTipoName(study.tipo)}
                        </small>
                        ${actionButton}
                    </div>
                </div>
            </div>
        `;
    }

    getFiliereIcon(filiera) {
        const icons = {
            'alimentare': 'üçΩÔ∏è',
            'chimica': 'üß™',
            'meccanica': '‚öôÔ∏è',
            'ict': 'üíª',
            'edilizia': 'üèóÔ∏è',
            'tessile': 'üëî',
            'trasporti': 'üöõ',
            'energia': '‚ö°',
            'servizi': 'üè¢'
        };
        return icons[filiera] || 'üìã';
    }

    getTipoIcon(tipo) {
        return 'üìä';
    }

    getTipoName(tipo) {
        return 'Studio Mercato';
    }

    showStudyDetails(studyId) {
        const study = this.allStudies.find(s => s.id === studyId);
        if (!study) return;

        const title = study.nome_nativo || study.nome_inglese;
        document.getElementById('modalStudyTitle').textContent = title;
        
        document.getElementById('studyDetailsContent').innerHTML = `
            <div class="row">
                <div class="col-md-8">
                    <h4>${title}</h4>
                    ${study.nome_inglese && study.nome_inglese !== title ? `<h5 class="text-muted mb-3">${study.nome_inglese}</h5>` : ''}
                    
                    <div class="mb-4">
                        <h6>üìã Descrizione Settore</h6>
                        <p>${study.descrizione_100_parole}</p>
                    </div>
                    
                    ${study.keywords ? `
                        <div class="mb-4">
                            <h6>üè∑Ô∏è Keywords</h6>
                            <div class="keywords-container">
                                <strong>Lingua nativa:</strong><br>
                                ${study.keywords.nativo.map(word => 
                                    `<span class="badge bg-light text-dark me-2 mb-2">${word}</span>`
                                ).join('')}
                                <br><strong>Inglese:</strong><br>
                                ${study.keywords.inglese.map(word => 
                                    `<span class="badge bg-light text-dark me-2 mb-2">${word}</span>`
                                ).join('')}
                            </div>
                        </div>
                    ` : ''}

                    <div class="mb-4">
                        <h6>üîó Studi Correlati</h6>
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle"></i>
                            Studi correlati nella stessa filiera e benchmark internazionali disponibili nel database completo.
                        </div>
                    </div>
                </div>
                
                <div class="col-md-4">
                    <div class="border rounded p-3 bg-light">
                        <h6>üìç Informazioni Studio</h6>
                        <p><strong>Mercato:</strong> ${study.market_flag} ${study.mercato}</p>
                        <p><strong>Filiera:</strong> ${this.getFiliereIcon(study.filiera)} ${study.filiera.charAt(0).toUpperCase() + study.filiera.slice(1)}</p>
                        <p><strong>Status:</strong> ${study.disponibile ? 'üü¢ Disponibile' : 'üü° Su Richiesta'}</p>
                        <hr>
                        ${study.codice_ateco ? `<p><strong>ATECO:</strong> ${study.codice_ateco}</p>` : ''}
                        ${study.codice_nace ? `<p><strong>NACE:</strong> ${study.codice_nace}</p>` : ''}
                        <p><strong>ID Studio:</strong> ${study.id}</p>
                    </div>
                </div>
            </div>
        `;

        // Configura pulsanti
        const buyBtn = document.getElementById('buyStudyBtn');
        const requestBtn = document.getElementById('requestStudyBtn');
        
        if (study.disponibile) {
            buyBtn.style.display = 'inline-block';
            requestBtn.style.display = 'none';
        } else {
            buyBtn.style.display = 'none';
            requestBtn.style.display = 'inline-block';
            requestBtn.href = this.generateRequestEmail(study);
        }

        new bootstrap.Modal(document.getElementById('studyDetailModal')).show();
    }

    requestStudy(studyId) {
        const study = this.allStudies.find(s => s.id === studyId);
        const emailUrl = this.generateRequestEmail(study);
        window.open(emailUrl);
    }

    generateRequestEmail(study) {
        const title = study.nome_nativo || study.nome_inglese;
        const subject = `Richiesta Fattibilit√† Studio: ${title} (${study.mercato})`;
        
        const body = `Gentile Team Plimsoll,

Vorrei richiedere la valutazione di fattibilit√† per lo sviluppo dello studio:

DETTAGLI STUDIO:
- Nome: ${title}
- Nome Inglese: ${study.nome_inglese || 'N/A'}
- Mercato: ${study.mercato}
- ID: ${study.id}
${study.codice_ateco ? `- Codice ATECO: ${study.codice_ateco}` : ''}
${study.codice_nace ? `- Codice NACE: ${study.codice_nace}` : ''}
- Filiera: ${study.filiera}

Per maggiori informazioni sui servizi Plimsoll:
https://p0.me-page.com/project/289223/f52161219504742f83c20630d9133419

Cordiali saluti,
[Nome]
[Azienda]
[Contatti]`;

        return `mailto:info@plimsoll.it?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
    }

    // Metodi di filtro e ricerca
    performSearch(query) {
        if (!query || query.length < 2) {
            this.filteredStudies = [...this.allStudies];
            this.currentPage = 1;
            this.renderStudies();
            return;
        }

        const searchTerm = query.toLowerCase();
        this.filteredStudies = this.allStudies.filter(study => {
            const nomeNativo = (study.nome_nativo || '').toLowerCase();
            const nomeInglese = (study.nome_inglese || '').toLowerCase();
            const ateco = (study.codice_ateco || '').toLowerCase();
            const nace = (study.codice_nace || '').toLowerCase();
            const descrizione = (study.descrizione_100_parole || '').toLowerCase();
            
            // Ricerca nelle keywords
            let keywordsMatch = false;
            if (study.keywords) {
                Object.values(study.keywords).forEach(wordsList => {
                    if (wordsList.some(kw => kw.toLowerCase().includes(searchTerm))) {
                        keywordsMatch = true;
                    }
                });
            }
            
            return nomeNativo.includes(searchTerm) ||
                   nomeInglese.includes(searchTerm) ||
                   ateco.includes(searchTerm) ||
                   nace.includes(searchTerm) ||
                   descrizione.includes(searchTerm) ||
                   keywordsMatch;
        });
        
        this.currentPage = 1;
        this.renderStudies();
    }

    applyFilters() {
        const marketFilter = document.getElementById('marketFilter').value;
        const filiereFilter = document.getElementById('filiereFilter').value;
        const statusFilter = document.getElementById('statusFilter').value;
        const atecoSearch = document.getElementById('atecoSearch').value;
        const naceSearch = document.getElementById('naceSearch').value;
        const keywordSearch = document.getElementById('keywordSearch').value;
        const searchQuery = document.getElementById('searchInput').value;

        let filtered = [...this.allStudies];

        // Filtro ricerca testuale
        if (searchQuery && searchQuery.length >= 2) {
            const searchTerm = searchQuery.toLowerCase();
            filtered = filtered.filter(study => {
                const nomeNativo = (study.nome_nativo || '').toLowerCase();
                const nomeInglese = (study.nome_inglese || '').toLowerCase();
                const descrizione = (study.descrizione_100_parole || '').toLowerCase();
                
                return nomeNativo.includes(searchTerm) ||
                       nomeInglese.includes(searchTerm) ||
                       descrizione.includes(searchTerm);
            });
        }

        // Filtri specifici
        if (marketFilter) {
            filtered = filtered.filter(study => study.mercato === marketFilter);
        }

        if (filiereFilter) {
            filtered = filtered.filter(study => study.filiera === filiereFilter);
        }

        if (statusFilter) {
            const isAvailable = statusFilter === 'true';
            filtered = filtered.filter(study => study.disponibile === isAvailable);
        }

        if (atecoSearch) {
            filtered = filtered.filter(study => 
                study.codice_ateco && study.codice_ateco.includes(atecoSearch)
            );
        }

        if (naceSearch) {
            filtered = filtered.filter(study => 
                study.codice_nace && study.codice_nace.includes(naceSearch)
            );
        }

        if (keywordSearch) {
            const keywordTerm = keywordSearch.toLowerCase();
            filtered = filtered.filter(study => {
                if (!study.keywords) return false;
                return Object.values(study.keywords).some(wordsList =>
                    wordsList.some(kw => kw.toLowerCase().includes(keywordTerm))
                );
            });
        }

        this.filteredStudies = filtered;
        this.currentPage = 1;
        this.renderStudies();
    }

    bindEvents() {
        const searchInput = document.getElementById('searchInput');
        const clearSearch = document.getElementById('clearSearch');
        const marketFilter = document.getElementById('marketFilter');
        const filiereFilter = document.getElementById('filiereFilter');
        const statusFilter = document.getElementById('statusFilter');
        const atecoSearch = document.getElementById('atecoSearch');
        const naceSearch = document.getElementById('naceSearch');
        const keywordSearch = document.getElementById('keywordSearch');
        const resetFilters = document.getElementById('resetFilters');
        const prevPage = document.getElementById('prevPage');
        const nextPage = document.getElementById('nextPage');
        const showAllStudies = document.getElementById('showAllStudies');

        // Eventi di ricerca
        searchInput.addEventListener('input', (e) => {
            this.performSearch(e.target.value);
        });

        clearSearch.addEventListener('click', () => {
            searchInput.value = '';
            this.filteredStudies = [...this.allStudies];
            this.currentPage = 1;
            this.renderStudies();
        });

        // Eventi filtri
        [marketFilter, filiereFilter, statusFilter].forEach(filter => {
            filter.addEventListener('change', () => this.applyFilters());
        });

        [atecoSearch, naceSearch, keywordSearch].forEach(input => {
            input.addEventListener('input', () => this.applyFilters());
        });

        // Reset filtri
        resetFilters.addEventListener('click', () => {
            [searchInput, atecoSearch, naceSearch, keywordSearch].forEach(input => input.value = '');
            [marketFilter, filiereFilter, statusFilter].forEach(select => select.value = '');
            this.filteredStudies = [...this.allStudies];
            this.currentPage = 1;
            this.renderStudies();
        });

        // Paginazione
        prevPage.addEventListener('click', () => {
            if (this.currentPage > 1) {
                this.currentPage--;
                this.renderStudies();
                window.scrollTo(0, 0);
            }
        });

        nextPage.addEventListener('click', () => {
            const maxPage = Math.ceil(this.filteredStudies.length / this.studiesPerPage);
            if (this.currentPage < maxPage) {
                this.currentPage++;
                this.renderStudies();
                window.scrollTo(0, 0);
            }
        });

        // Mostra tutti gli studi
        showAllStudies.addEventListener('click', () => {
            this.filteredStudies = [...this.allStudies];
            this.currentPage = 1;
            this.renderStudies();
        });
    }

    updateResultsCount() {
        document.getElementById('resultsCount').textContent = this.filteredStudies.length.toLocaleString();
        document.getElementById('totalCount').textContent = this.allStudies.length.toLocaleString();
    }

    updatePagination() {
        const maxPage = Math.ceil(this.filteredStudies.length / this.studiesPerPage);
        const prevBtn = document.getElementById('prevPage');
        const nextBtn = document.getElementById('nextPage');
        const currentPageSpan = document.getElementById('currentPage');

        currentPageSpan.textContent = this.currentPage;
        
        prevBtn.disabled = this.currentPage <= 1;
        nextBtn.disabled = this.currentPage >= maxPage;

        if (this.currentPage <= 1) {
            prevBtn.classList.add('disabled');
        } else {
            prevBtn.classList.remove('disabled');
        }

        if (this.currentPage >= maxPage) {
            nextBtn.classList.add('disabled');
        } else {
            nextBtn.classList.remove('disabled');
        }
    }

    updateStatistics() {
        // Aggiorna le statistiche reali basate sui dati caricati
        const mercatiStats = {};
        this.allStudies.forEach(study => {
            const mercato = study.mercato;
            mercatiStats[mercato] = (mercatiStats[mercato] || 0) + 1;
        });

        // Mostra i numeri reali dal database
        document.getElementById('totalStudies').textContent = this.allStudies.length.toLocaleString();
        document.getElementById('italiaStudies').textContent = (mercatiStats['Italia'] || 0).toLocaleString();
        document.getElementById('ukStudies').textContent = (mercatiStats['Regno Unito'] || 0).toLocaleString();
        document.getElementById('frStudies').textContent = (mercatiStats['Francia'] || 0).toLocaleString();
        document.getElementById('spStudies').textContent = (mercatiStats['Spagna'] || 0).toLocaleString();
        document.getElementById('globalStudies').textContent = (mercatiStats['Globale'] || 0).toLocaleString();
    }
}

// Inizializza il sistema
let catalogSystem;
document.addEventListener('DOMContentLoaded', () => {
    catalogSystem = new CompletePlimsollCatalogSystem();
});
</script>

</body>
</html>
